<!DOCTYPE html>

<html class="h-100" lang="en">

    <head>

        <meta charset="utf-8">
        <meta name="viewport" content="initial-scale=1, width=device-width">

        <meta property="og:description" content="This is CS50W, CS50&#39;s Web Programming with Python and JavaScript. Register for free at https://cs50.edx.org/web. Slides and source code at https://cs50.harvard.edu/web. Playlist at https://www.youtube.com/playlist?list=PLhQjrBD2T380xvFSUmToMMzERZ3qB5Ueu. ">
        <meta property="og:image" content="https://img.youtube.com/vi//maxresdefault.jpg">
        <meta property="og:title" content="CS50W - Lecture 4 - SQL, Models and Migrations">
        <meta property="og:type" content="website">
        <meta property="og:url" content="https://video.cs50.io/YzP164YANAU">

        <!-- https://gauger.io/fonticon/ -->
<link href="/static/favicon.png" rel="shortcut icon">

<link rel="stylesheet" href="https://kit.fontawesome.com/87d0de8c5d.css" crossorigin="anonymous">

<link href="/static/dist/main.css?1767326716" rel="stylesheet">
<script src="/static/dist/main.js?1767326716"></script>

<script>

    // https://getbootstrap.com/docs/5.3/customize/color-modes/#javascript
    $(function() {

        function getPreferredTheme() {
            return window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light';
        }

        function setTheme(theme) {
            if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
                document.documentElement.setAttribute('data-bs-theme', 'dark')
            }
            else {
                document.documentElement.setAttribute('data-bs-theme', theme)
            }
        }

        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', () => {
            setTheme(getPreferredTheme());
        });
        setTheme(getPreferredTheme());

    });

</script>

        <!-- https://iframe-resizer.com/setup/child/ -->
        <script>
            window.iFrameResizer = {

                // https://iframe-resizer.com/api/child/#onbeforeresizenewsize
                onBeforeResize: function() {

                    // Player's width
                    const width = $('#main').outerWidth();

                    // Player's ideal height, assuming 16x9
                    let height = width / 16 * 9;

                    // Player's actual height with nav
                    return Math.round(height + $('nav').outerHeight());
                }
            };
        </script>

        <style>

            body {
                background-color: #000;
            }

            .navbar-brand {
                font-size: 1.125rem;
            }

            .fab.fa-youtube {
                font-size: 1.5em;
            }

            .custom-control-sm {
                font-size: .875rem;
                padding-bottom: .5rem; /* A la .nav-link */
                padding-top: .5rem; /* A la .nav-link */
            }
            .custom-control-sm .custom-control-label::before {
                top: .2rem;
            }
            .custom-control-sm .custom-control-label::after {
                top: calc(.2rem + 2px);
            }

            #captions, #chapters {
                max-height: 80vh;
                max-width: 50vw;
            }

            #snacks {
                max-height: 80vh;
                min-width: 0;
            }

            /* https://github.com/twitter/twemoji#inline-styles */
            #snacks img.emoji {
                height: 1em;
                margin: 0 .05em 0 .1em;
                vertical-align: -0.1em;
                width: 1em;
            }

            #snacks .dropdown-item {
                cursor: pointer;
                font-size: 2rem;
            }

            .mark, mark {
                padding: 0;
            }

        </style>

        <title>
            CS50W - Lecture 4 - SQL, Models and Migrations
        </title>
    </head>

    <body class="h-100 invisible overflow-hidden">

        <nav class="bg-body-tertiary navbar navbar-expand-md">

            <div class="container-fluid">

                <a class="btn btn-link navbar-brand px-0 text-muted" href="/" role="button" target="_top">
                    <i class="align-bottom fab fa-youtube pe-1"></i>
                    CS50
                    <span class="d-none d-lg-inline">Video Player</span>
                </a>

                

                <ul class="me-auto navbar-nav">
                    <li class="nav-item">
                        <div class="form-check form-switch mb-0">
                            <input class="form-check-input" disabled id="switch" type="checkbox">
                            <label class="form-check-label text-muted" for="switch">Screen</label>
                        </div>
                    </li>
                </ul>

                

                <div class="collapse navbar-collapse" id="navbar">

                    <ul class="ms-auto navbar-nav">
                        <li class="nav-item">
                            <button class="btn btn-link nav-link text-muted" data-bs-target="#shortcuts" data-bs-toggle="modal" type="button">
                                <i class="far fa-keyboard pe-1"></i>
                                Shortcuts
                            </button>
                        </li>
                    </ul>

                    <ul class="ms-2 navbar-nav">
                        <li class="nav-item">
                            <div class="dropdown">
                                <button aria-expanded="false" class="btn btn-link dropdown-toggle ms-auto nav-link text-muted" data-bs-toggle="dropdown" id="snacks-button" role="button">
                                    Snacks
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end overflow-auto" id="snacks"></ul>
                            </div>
                        </li>
                    </ul>

                    

                    <ul class="ms-2 navbar-nav">
                        <li class="nav-item">
                            <div class="dropdown">
                                <button aria-expanded="false" class="btn btn-link dropdown-toggle ms-auto nav-link text-muted" data-bs-toggle="dropdown" id="chapters-button" role="button">
                                    Chapters
                                </button>
                                <ul class="dropdown-menu dropdown-menu-end overflow-auto" id="chapters"></ul>
                            </div>
                        </li>
                    </ul>

                    

                    

                    <!-- https://stackoverflow.com/a/45696757 -->
                    <ul class="ms-2 navbar-nav">
                        <li class="nav-item">
                            <div class="input-group">
                                <input autocomplete="off" class="form-control" disabled id="q" placeholder="Captions" type="search">
                                <button aria-expanded="false" class="btn btn-secondary dropdown-toggle" data-bs-auto-close="false" data-bs-toggle="dropdown" disabled id="captions-button" type="button"></button>
                                <ul class="dropdown-menu dropdown-menu-end overflow-auto" id="captions"></ul>
                            </div>
                        </li>
                    </ul>

                    

                    <ul class="ms-2 navbar-nav">
                        <li class="nav-item">
                            <a class="btn btn-link nav-link text-muted" href="https://cs50.ai/" target="_blank">
                                <i class="fa-regular fa-duck pe-1"></i>
                                CS50.ai
                            </a>
                        </li>
                    </ul>

                </div>

                <ul class="d-none ms-3 navbar-nav">
                    <li class="nav-item">
                        <a class="btn btn-link nav-link px-0 text-muted" href="https://video.cs50.io/YzP164YANAU?screen=VuB5TkTL3tM&amp;start=3812" role="button" target="_top">
                            <i aria-hidden="true" class="fas fa-external-link-alt"></i>
                        </a>
                    </li>
                </ul>

            </div>

        </nav>

        <div class="border-0 invisible w-100" id="main"></div>

        
        <div class="border-0 d-none w-100" id="screen"></div>
        

        <div aria-hidden="true" aria-labelledby="shortcuts" class="modal" data-bs-backdrop="static" id="shortcuts" role="dialog" tabindex="-1">
            <div class="min-vh-100 modal-dialog modal-dialog-centered my-0">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title"><i class="far fa-keyboard pe-2"></i>Shortcuts</h5>
                        <button aria-label="Close" class="btn-close" data-bs-dismiss="modal" type="button"></button>
                    </div>
                    <div class="modal-body">
                        <div class="alert" role="alert">
                            Before using a shortcut, click at least once on the video itself (to give it "focus") after closing this window.
                        </div>
                        <table class="table table-borderless table-sm">
                            <tbody>
                                <tr>
                                    <td>Play/Pause</td>
                                    <td><kbd>spacebar</kbd> or <kbd>k</kbd></td>
                                </tr>
                                <tr>
                                    <td>Rewind 10 seconds</td>
                                    <td><kbd>left arrow</kbd> or <kbd>j</kbd></td>
                                </tr>
                                <tr>
                                    <td>Fast forward 10 seconds</td>
                                    <td><kbd>right arrow</kbd> or <kbd>l</kbd></td>
                                </tr>
                                <tr>
                                    <td>Previous frame (while paused)</td>
                                    <td><kbd>,</kbd></td>
                                </tr>
                                <tr>
                                    <td>Next frame (while paused)</td>
                                    <td><kbd>.</kbd></td>
                                </tr>
                                <tr>
                                    <td>Decrease playback rate</td>
                                    <td><kbd>&lt;</kbd></td>
                                </tr>
                                <tr>
                                    <td>Increase playback rate</td>
                                    <td><kbd>&gt;</kbd></td>
                                </tr>
                                <tr>
                                    <td>Toggle captions on/off</td>
                                    <td><kbd>c</kbd></td>
                                </tr>
                                <tr>
                                    <td>Toggle mute</td>
                                    <td><kbd>m</kbd></td>
                                </tr>
                                <tr>
                                    <td>Toggle full screen</td>
                                    <td><kbd>f</kbd> or double-click video</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>

        <script>
            // Offset for screen
            const offset = 0 / 1000;

            // Overrides for playerVars
            const playerVars = {
                modestbranding: '0'
            };

            // If embedded
            if (window.self !== window.top) {
                $('nav .navbar-nav').last().removeClass('d-none');
                playerVars.modestbranding = '1';
            }

            // If resuming
            const url = new URL(window.location.href);
            if (url.searchParams.get('start') === null) {
                try {
                    playerVars.start = (localStorage.getItem(url.pathname.slice(1)) || 0).toString();
                }
                catch(err) {}
            }

            // On resize
            function resize() {

                // If < extra small and iframed, hide navbar
                // https://getbootstrap.com/docs/4.5/layout/grid/
                if ($(window).width() < 576 && window.self !== window.top) {
                    $('nav').addClass('d-none');
                }

                // If < large, shrink navbar
                // https://getbootstrap.com/docs/5.2/layout/grid/#grid-options
                else if ($(window).width() < 992) {
                    $('nav').removeClass('d-none');
                    $('nav .custom-control').addClass('custom-control-sm');
                    $('nav .btn').addClass('btn-sm');
                    $('nav .form-control').addClass('form-control-sm');
                    $('nav .dropdown-item').addClass('small');
                }
                else {
                    $('nav').removeClass('d-none');
                    $('nav .custom-control').removeClass('custom-control-sm');
                    $('nav .btn').removeClass('btn-sm');
                    $('nav .form-control').removeClass('form-control-sm');
                    $('nav .dropdown-item').removeClass('small');
                }

                // Fill rest of viewport
                $('#main, #screen').height(($(window).height() - $('nav').outerHeight()) + 'px');
            }

            
            
            // Chapters
            const chapters = [[0, "Introduction"], [15, "SQL"], [483, "Tables"], [863, "SQL Queries"], [1816, "Joining Tables"], [2954, "Django Models"], [3094, "Migrations"], [3230, "Shell"], [4276, "Django Admin"], [4749, "Many-to-Many Relationships"], [6020, "Users"]];

            // Add chapters to dropdown
            for (let i = 0; i < chapters.length; i++) {

                // URL for caption
                const url = new URL(window.location.href);

                // Set start
                url.searchParams.set('start', chapters[i][0])

                // Set end, unless last chapter
                if (i !== chapters.length - 1) {
                    url.searchParams.set('end', chapters[i+1][0]);
                }

                // Add chapter to dropdown
                const $a = $('<a class="dropdown-item overflow-hidden text-truncate" data-start="' + chapters[i][0] + '" href="' + url.href + '">');
                let $span = $('<span class="d-inline-block me-3 text-end">');
                $span.append($('<span class="badge text-bg-secondary">').text(numeral(chapters[i][0]).format('00:00:00')));
                $a.append($span);
                $span = $('<span>').text(chapters[i][1]);
                $a.append($span);
                $('#chapters').append($('<li>').append($a));

                // Listen for clicks
                $a.on('click', function(event) {

                    // Unless a modifer key is being pressed
                    if (!event.ctrlKey && !event.metaKey && !event.shiftKey) {
                        if ($('#switch').is(':checked')) {
                            screen.seekTo($(this).attr('data-start') - offset);
                            screen.playVideo();
                        }
                        else {
                            main.seekTo($(this).attr('data-start'));
                            main.playVideo();
                        }
                        event.preventDefault();
                    }
                });
            }

            
            // Hide captions when showing chapters or snacks
            $('#chapters, #snacks').parent().on('show.bs.dropdown', function() {
                //$('#captions').hide();
                bootstrap.Dropdown.getOrCreateInstance($('#captions-button').get(0)).hide();
            });
            

            

            

            // Captions
            const captions = [[0.0, "[MUSIC PLAYING]"], [17.72, "BRIAN YU: All right, welcome back everyone"], [19.47, "to Web Programming with Python and JavaScript."], [21.75, "So last time we took a look at a brand new web framework"], [24.63, "written in Python called Django."], [26.64, "And what Django allowed us to do was to build dynamic web applications."], [30.27, "Applications where we now had the ability"], [32.58, "to not just display the same HTML and CSS to the user every single time,"], [36.54, "but to dynamically generate HTML in order"], [38.91, "to allow users to interact with a page that was a little bit more dynamic."], [42.27, "Doing things like rendering things on the page only if a certain condition"], [45.72, "was true."], [46.5, "Or looping over a list of values and displaying one HTML element"], [50.67, "for each of those possible values."], [52.5, "But where Django gets especially powerful"], [54.428, "and we\u0027re web application certainly get much more interesting"], [56.97, "is as we start to delve into the world of data"], [59.64, "and trying to have web applications that store data inside of a database."], [63.472, "And to do that we\u0027re going to introduce a couple of topics today."], [66.18, "In particular, we\u0027re going to introduce the idea of SQL, models,"], [69.42, "and migrations."], [70.59, "SQL is a database language that we can use to interact with databases"], [74.64, "and Django is going to allow us to have an abstraction layer on top of SQL."], [78.99, "To interact not by writing direct SQL queries,"], [81.63, "but by interacting with Python classes and objects"], [84.48, "that we\u0027re going to refer to as models."], [86.482, "And migrations are going to be a technique that"], [88.44, "are going to allow us to update our database in response to changes"], [92.25, "that we make to our underlying models."], [94.99, "So before we get into things that are more Django specific,"], [97.56, "let\u0027s begin with a discussion of SQL more generally."], [100.02, "And more broadly, just a discussion of data and the types of data"], [103.05, "that we\u0027re going to want to store."], [104.61, "And now there are a number of ways that we could try to store data inside"], [107.91, "of a computer system but oftentimes in databases,"], [110.73, "in particular, in a type of database known as a relational database,"], [114.33, "we\u0027re going to store data inside of a table where each table is"], [117.69, "going to have rows and columns."], [120.04, "So for the sake of today, we\u0027re going to imagine"], [122.04, "starting to construct a database and a web application"], [124.77, "that an airline might use."], [125.912, "For example, for keeping track of various different flights"], [128.37, "on that airline and keeping track of which passengers are on those flights."], [132.51, "And so what we have here is a sample table, for example,"], [135.66, "of how you might represent a whole bunch of flight related data."], [139.26, "Here I have three columns for three pieces of information"], [142.41, "that I might want to keep track of for any particular flight."], [145.14, "For any given flight I might want to know that flight\u0027s"], [147.432, "origin, what city it\u0027s weaving from."], [149.01, "Its destination, what city it\u0027s arriving at."], [151.38, "And its duration, some value in minutes of how long"], [154.38, "it\u0027s going to take the flight to get from the origin to the destination."], [158.17, "So each of those columns represents one field"], [160.35, "that I might want to keep track of about my data."], [162.69, "And each row, meanwhile, is going to represent an individual flight."], [166.5, "So here, for example, is one row representing one flight from New York"], [170.28, "to London and that flight just so happens to take 415 minutes."], [175.29, "And so what SQL is going to allow us to do"], [177.33, "is it is going to be a database of language that"], [179.82, "is designed to interact with relational database management systems."], [183.66, "Databases that organize data into tables where every table has rows and columns."], [188.61, "And it turns out, there are a number of different database management systems"], [191.82, "that implement parts of the SQL standard of this type of language."], [195.18, "Some of the more popular are MySQL, PostgreSQL, and SQLite"], [199.02, "but there are definitely others as well."], [200.687, "And each of these has various different features and different use cases"], [203.687, "where some might be more appropriate."], [205.34, "MySQL and PostgreSQL, otherwise known as just Postgres,"], [209.22, "are more heavier database management systems, so to speak."], [212.85, "They\u0027re generally running on servers elsewhere where a lot of big companies"], [216.96, "will use servers like this in order to store data"], [219.573, "and represent their data in a sort of a separate database where."], [222.24, "The idea of that is that you might want your web application running"], [225.12, "on one server but you might want your database"], [227.053, "running as an entirely separate process."], [228.72, "Such that they can behave independently, you can debug and test them"], [231.69, "independently, and if one goes down, the other doesn\u0027t go down as well."], [236.01, "SQLite is a bit of a simpler lighter weight"], [238.44, "implementation of the SQL standard."], [240.42, "And what SQLite is going to do is rather than be an entire server that"], [243.83, "is going to be listening for requests and making responses,"], [246.6, "SQLite is just going to store all of its data as a single file."], [250.15, "So we\u0027re going to store SQL data inside of a SQLite file"], [252.63, "and that\u0027s going to make it a little bit easier for us"], [254.88, "as we\u0027re just getting started to begin to write queries and add things"], [258.18, "to our database and retrieve things from our database."], [260.61, "But know that many of the same types of SQL syntax that we\u0027ll see with SQLite,"], [264.15, "which is Django\u0027s default, can also be applied"], [266.73, "to other languages as well and other database management systems too."], [271.05, "So as we begin to store data inside of a SQL database,"], [274.17, "ultimately each of those pieces of data has a type."], [277.167, "In the same way that in Python we have types"], [279.0, "for various different types of data, we have integers and we have strings"], [282.33, "and we have lists and tuples and so forth."], [284.37, "SQL too has types that represent various different categories of information"], [289.17, "that you might want to store inside of a database."], [291.37, "And each database management system has its own different set of types."], [294.66, "SQLite for example, has a fairly short list of basic types that it supports."], [299.58, "It supports text for just like strings of text, for example."], [303.24, "Something like a city name, for instance, might be stored as text."], [306.36, "We have support for integers, which are just 0, 1, 2, 3 4"], [309.66, "plus the negative numbers, negative 1, negative 2, negative 3, and so forth."], [314.11, "We have support for real numbers where real numbers don\u0027t"], [316.59, "have to just be integers, they can have something after the decimal point."], [319.88, "Something like 2.8 or something else that might have a decimal in it."], [323.39, "And then numeric is another category for data that\u0027s just more generally"], [326.96, "some sort of number that might number like data,"], [329.37, "so something like a Boolean value or something like a date, for example,"], [333.35, "might be stored using this numeric type."], [335.03, "Where it\u0027s not really an integer or a real number,"], [337.113, "though you could represented at such, it\u0027s other numeric type of data."], [341.1, "And then finally blob, which stands for binary large object,"], [344.51, "is any type of other binary data."], [346.37, "Just zeros and ones that you might want to store inside of your database."], [349.98, "So for example, if you\u0027re storing files, maybe they\u0027re"], [352.25, "audio files or images or other types of files"], [354.68, "that you want to keep track of inside of your database,"], [357.3, "you can store just pure binary data inside of a SQL database as well."], [362.01, "So these now are the basic types of SQLite supports"], [365.03, "but other database management systems have"], [366.86, "other types that they support as well."], [368.45, "MySQL, you all for example, has a much longer list of other types"], [371.69, "that it supports."], [372.77, "In addition to just supporting a text type for arbitrary length text,"], [376.34, "MySQL also has a type called char that takes an argument of size."], [380.75, "For saying I want like size characters worth of data"], [383.87, "that we\u0027re going to store inside the database."], [385.79, "And you might imagine that this can be advantageous in situations"], [388.85, "where you know that your data is going to be"], [390.77, "within a certain number of characters."], [392.45, "So if you\u0027re storing a zip code for example, in the United States."], [395.69, "A zip code in the United States might just be five characters"], [398.66, "and so you can allocate a character length"], [400.43, "of five characters worth of space for storing every single zip code"], [404.24, "inside of your database table."], [405.625, "So for efficiency\u0027s sake, if you know the maximum length,"], [408.38, "and you can fix that length inside your database,"], [410.99, "that can be an efficient choice."], [412.58, "VARCHAR of a size is similar."], [414.65, "And this is a variable length character."], [416.72, "If something isn\u0027t going to be exactly a certain number of characters,"], [419.72, "but maybe up to a certain number of characters,"], [422.06, "you can use VARCHAR to say maybe sometimes it\u0027s"], [424.16, "going to be fewer characters."], [425.63, "But it could be up to size, number of characters."], [428.84, "And there are tradeoffs there, too."], [431.015, "Then there are various different types of integers."], [433.14, "There\u0027s not just a single integer type."], [435.06, "But SMALLINT and INT and BIGINT, each of which uses a different number of"], [438.71, "bytes in order to store an integer data."], [441.0, "So if you want to be able to store much larger or much smaller numbers,"], [444.17, "you might need a bigger type, like an INT or a BIGINT."], [446.448, "But if your numbers are going to be pretty small,"], [448.49, "maybe you\u0027re OK with just a SMALLINT."], [450.49, "And likewise there are similar types of trade-offs for floating point numbers."], [453.74, "Where, much as in programming languages like C, if you\u0027re familiar,"], [456.532, "have both a float and a double type."], [458.42, "Where a double uses more bytes of memory in order to store information."], [462.08, "Here, too, we have FLOAT and DOUBLE, which allow"], [464.78, "us to store floating point numbers."], [466.41, "Numbers that might be real numbered values, where a double just"], [469.4, "allows us to express a number to a little bit more precision"], [472.46, "than a floating point number might be able to."], [474.53, "And there are many other types as well, but the general idea"], [477.03, "is that here even in SQL, much as in a language"], [479.33, "like Python, we have types for each of these various different kinds of data."], [483.99, "So now that we understand that each type of data has types, what we\u0027d like to do"], [487.64, "is to be able to, inside of a database, actually create a table."], [491.417, "And there are various different SQL commands"], [493.25, "that we can run on our database in order to perform"], [495.83, "various different operations."], [497.42, "And the first we might want to execute is"], [499.25, "a command that is just going to create a table, for example."], [502.53, "So how might we go about doing that?"], [504.15, "Well, it turns out the syntax for creating"], [505.9, "a table is going to look a little something like this."], [508.46, "This here is the syntax we would use to create a table in SQLite"], [512.63, "for representing flights, for example."], [515.419, "So we begin with the keyword Create Table,"], [518.299, "to say I would like to create a new table inside of this database."], [521.929, "Next I give the name of the table."], [523.85, "Every table has a name just for ease of reference."], [526.28, "And here the name and the table is just the word \"flights.\""], [529.88, "Then what follows in parentheses are a comma-separated list"], [533.75, "of all of the columns that should be present in the table."], [536.84, "I\u0027m not yet adding any data to the table."], [539.06, "The Create Table query is just going to decide the structure of the table."], [542.85, "What are the columns and what are the columns\u0027 types."], [545.95, "And so here we see that in the beginning of each"], [548.27, "of these clauses that are separated by commas, we have the name of the column."], [553.89, "So we have an id column because, though we didn\u0027t see this before, often in SQL"], [558.02, "it\u0027s going to be helpful to be able to have"], [559.91, "some way of uniquely referencing a particular element inside of the table."], [563.812, "Maybe there are multiple flights that are"], [565.52, "going from New York to London, for example,"], [568.97, "and I want some way of distinguishing between them."], [571.28, "And one easy way is to give every single entry inside of a table"], [575.21, "a unique identifier, or a unique id, represented here by this id column."], [580.037, "And that\u0027s going to be a way of making sure that we can always"], [582.62, "access a particular flight uniquely."], [585.56, "So we have an id column, an origin column, a destination column,"], [588.83, "and a duration column."], [590.48, "Each of those columns has a type."], [593.27, "So the types here, id is an integer."], [595.28, "It\u0027s just going to be some number representing the flight, counting one,"], [598.28, "two, three, four, and so on and so forth."], [600.5, "Origin and destination we\u0027ll label here as text."], [603.37, "Though you\u0027ll see that if we were using my SQL,"], [606.02, "I might make these a variable length character that"], [608.325, "could be up to a certain number of characters"], [610.2, "if I know there\u0027s probably not going to be"], [611.95, "a city that\u0027s longer than a certain number of characters, for instance."], [615.35, "Then I have a duration, which here is an integer."], [618.07, "Some number of minutes that is going to be"], [619.9, "how long it takes for this flight to go from the origin to the destination."], [624.72, "After the types for each of the columns, I"], [626.47, "have additional constraints that I might add to the columns as well."], [629.95, "So integer Primary Key."], [631.93, "The Primary Key here means that the id is"], [634.3, "going to be the primary way via which I uniquely identify a flight."], [638.32, "There\u0027s going to be some optimizations here"], [640.12, "to make it very quick to be able to look up a flight by its id."], [644.38, "Null is a constraint that I can place on columns to be able to say,"], [648.29, "I don\u0027t want to allow for this particular column to ever be empty."], [651.68, "I don\u0027t want there to ever be a flight that doesn\u0027t have an origin"], [654.43, "or doesn\u0027t have a destination or a duration."], [656.81, "So I can add constraints to a particular column to say,"], [660.46, "the origin, destination, duration, columns"], [662.95, "should not be allowed to be null."], [664.69, "I want to always have an origin and a destination and a duration."], [669.22, "Finally this Autoincrement after the Primary Key"], [672.1, "is a cue into SQL to automatically update the id every time"], [675.97, "I add a new row into the table."], [677.582, "So if I add a new flight, I can give the flight"], [679.54, "an origin, destination, and duration."], [681.55, "But I don\u0027t have to worry about giving it an id."], [683.888, "SQL is going to handle that for me automatically."], [685.93, "Automatically giving that new row in that table the next available id"], [692.68, "number."], [693.73, "Here, then, is the way we create a table by giving the name of the table,"], [697.03, "each of the columns, the types for each of those columns,"], [699.94, "and then any constraints we would want to place on the columns."], [704.39, "There are a number of different types of constraints"], [706.69, "that I can add to a particular column."], [708.37, "Not null is one we\u0027ve seen before."], [710.14, "You can add a default, which just adds a default value to a particular column."], [714.79, "Primary Key we\u0027ve seen."], [716.05, "Unique guarantees that every value is going to be unique."], [719.23, "So if you don\u0027t want to allow for the same value"], [721.84, "to appear twice for a particular column, you"], [724.257, "can add a unique constraint to a particular column"], [726.34, "to enforce that as well."], [728.2, "Check can be used to make sure that a value obeys a certain condition."], [732.16, "Like, a number falls within a certain range, for example."], [734.898, "If you have movie ratings, for example, and you\u0027re storing movie ratings inside"], [738.19, "of a database, you might care to make sure"], [739.99, "that those ratings are within the 1 to 5 range or the 1 to 10 range"], [743.89, "or whatever range you deem valid for the database."], [747.19, "So via constraints you can begin to ensure"], [749.5, "that as you add data to the table, that data is going to be valid in some way."], [753.46, "That it needs to obey and certain constraints,"], [756.13, "otherwise, if you try to add it to the table,"], [758.24, "it\u0027s not going to be accepted at all."], [760.9, "And so that leads into the natural next question, which"], [763.3, "is, I now have all of these various different tables"], [765.94, "that I can create using these create table commands,"], [768.43, "but how do I actually add data into those tables?"], [771.67, "The way we\u0027re going to do that is via an INSERT command, where we\u0027re"], [775.03, "going to insert data into a SQL table."], [778.39, "So what might that command look like?"], [780.01, "The command is generally going to look like this."], [782.65, "We\u0027re going to say, INSERT Into, to say I"], [785.14, "would like to add a new row into a table."], [788.17, "Following that, we provide the name of the table."], [790.24, "Something like \"flight\" to say, I would like"], [792.073, "to add a new row to the flights table."], [794.65, "And following the name of the table, we need"], [796.66, "to provide in parentheses a comma-separated list"], [799.9, "of all of the column names for which we are going to provide values."], [804.83, "So here I said I want to provide values for the origin, destination,"], [808.67, "and duration of this flight."], [810.73, "Note that I\u0027m leaving out the ID column."], [812.53, "I don\u0027t have to worry about adding a value for the ID,"], [815.118, "because I said the id should autoincrement."], [816.91, "So it\u0027s going to automatically give the next available ID."], [820.45, "And what values am I going to provide?"], [822.34, "Well, after the word \"values\", I provide, again,"], [824.9, "in parentheses, a comma-separated list of all of the values"], [828.67, "that are to be associated with those columns in the same order."], [831.97, "So origin was the first one here."], [833.87, "So origin will correspond to New York."], [835.81, "Destination will correspond to London."], [837.85, "Duration will correspond to 415."], [840.91, "So this query let\u0027s me take the flights table that I\u0027ve already created"], [844.75, "and add some data into that table."], [849.01, "So you can use these INSERT queries once you"], [851.29, "have a table to being able to add new rows of data to that table."], [854.47, "Every time a new flight comes up for an airline,"], [856.78, "the airline might, behind the scenes, be running an INSERT"], [859.57, "into Flights command that takes data about that flight"], [862.81, "and adds it to the table."], [864.34, "But, of course, once we\u0027ve added data to a table,"], [866.92, "we\u0027d ideally like some way to get data out of that table, as well."], [870.78, "That once we\u0027ve stored data inside of our database"], [873.22, "we want to retrieve that data, too."], [875.35, "To do that, we\u0027re going to use a particular type of query"], [878.29, "called a SELECT query."], [879.76, "What SELECT is going to do is take a table that already exists"], [883.69, "and allow us to get data out of that table."], [886.682, "It\u0027s not going to modify the data that\u0027s there,"], [888.64, "it\u0027s just going to retrieve data that might be inside a particular table."], [892.342, "So what do those queries look like?"], [893.8, "Well, the simplest query might look a little something like this."], [896.508, "SELECT * from flights."], [899.14, "SELECT from flights means I want to select data from the flights table."], [903.58, "And this * is a wild card that here just means"], [907.0, "select all of the possible columns that you can."], [910.06, "So if this is my table, my table of flights"], [911.92, "where each flight has an id, an origin, a destination, and a duration,"], [916.97, "then select * from flights will select all of that data."], [920.09, "All of the rows and all of the columns are"], [922.31, "going to come back to me when I run a query like this."], [925.948, "Now it\u0027s possible that when I\u0027m running these queries, when I\u0027m accessing data,"], [929.24, "that I don\u0027t actually care about all of these columns,"], [931.638, "especially if I have a table with many more columns than just this."], [934.43, "Maybe I only care about particular columns."], [937.16, "And it would be wasteful to query the database"], [939.17, "asking it to return to me a whole lot more data than I actually need."], [943.23, "So instead I could run query like this."], [945.89, "SELECT-- instead of * I\u0027m saying select origin comma destination from flights."], [952.31, "So I\u0027m again selecting from the flights table."], [954.24, "Selecting all of the rows still, but the difference"], [957.5, "is that instead of select *, which means select all of the columns that"], [961.19, "are present in the table, select origin comma destination means I\u0027m only"], [965.39, "going to select these two columns--"], [967.37, "the origin column and the destination column."], [969.89, "So highlighted in blue here is the data that"], [972.17, "would be returned if someone were to run this particular SQL query."], [976.82, "Now especially as tables begin to get larger and begin to have more and more"], [980.27, "rows-- here I just have six rows, but you might imagine a table with"], [983.39, "thousands or even millions of rows within it--"], [985.82, "you probably don\u0027t want to be returning every single row every single time."], [989.91, "So just as you can constrain which columns come back to you,"], [992.7, "likewise, you too can constrain which rows come back"], [995.24, "to you when you perform a query."], [997.31, "So I could say something like select * from flights where id= \"3.\""], [1001.62, "Again, this reads as very English like."], [1003.91, "I\u0027m saying select all of the columns from the flights table,"], [1007.69, "but not all of the rows."], [1009.01, "I only want to select the rows where--"], [1011.77, "this is a SQL keyword--"], [1013.15, "where id= \"3.\""], [1014.95, "ID is the name of a column, 3 is the value,"], [1017.62, "and it\u0027s going to look through this table, only find me the flights"], [1020.47, "where the id is equal to 3, and I\u0027ll just get back that one row as a result."], [1025.24, "It finds the row with an ID of 3, and it gives that back to me."], [1030.369, "If, instead, I said select * from flights where origin= \"New York,\""], [1034.27, "I can see that I don\u0027t just need to filter on the primary key--"], [1037.06, "the id-- I can also filter on any other column."], [1039.67, "I can say, give me all the flights where New York is the origin."], [1042.92, "So all the flights leaving from New York."], [1044.974, "You might imagine that in New York\u0027s airport,"], [1046.849, "for example they likely want some sort of query that\u0027s"], [1049.57, "going to find all the flights leaving from New York such"], [1052.0, "that they can display on a screen of some sort all of the departures"], [1055.48, "from that particular airport."], [1056.77, "So you could run a query like this and get back"], [1059.05, "only the rows in this database, inside of this table, that happened to have"], [1063.13, "an origin of New York, for example."], [1066.32, "So let\u0027s go ahead and take a look at how we might actually"], [1069.1, "run some of these queries inside of a SQL database."], [1073.31, "So in order to create a SQLite database, which is really just a file,"], [1077.06, "I can start just by creating the file."], [1079.24, "It turns out that in the terminal, there is a command called Touch that"], [1082.42, "will create a brand new file for me."], [1084.61, "So I\u0027m going to create a file called flights.sql."], [1088.65, "It\u0027s going to be a SQLite database file that by default has nothing in it."], [1092.68, "But then, assuming you have SQLite installed,"], [1095.14, "I can run SQLite 3 followed by flights.sql,"], [1100.15, "and now I\u0027m inside of the SQLite prompt."], [1102.7, "I can now begin to write commands that will be executed on this SQL database."], [1108.23, "So one thing I might do is create a table called \"flights.\""], [1112.37, "In this table, I want to have an id column, which is an integer."], [1116.66, "It should be the primary key, the main way via which I identify a flight."], [1120.25, "I would like to autoincrement it."], [1122.893, "I would also like for the flights table to have an origin, which"], [1125.56, "will be a text field that is not null."], [1128.19, "I\u0027ll add a destination field, also a text field that is not null."], [1132.49, "And then finally I\u0027ll add a duration field,"], [1134.65, "which is an integer that also shouldn\u0027t be null."], [1137.41, "I\u0027ll end with an end parentheses and a semicolon, press Return,"], [1140.83, "and that executes that command on my database."], [1143.44, "I have now created a table called \"flights.\""], [1146.26, "To verify this in SQLite, in the prompt I can type .tables,"], [1150.15, "and that will show me all of the tables that currently exist in my database."], [1154.21, "It just so happens that I have a table called \"flights.\""], [1157.335, "Of course, there\u0027s nothing inside this table, which"], [1159.46, "I can verify by running SELECT * from flights,"], [1162.48, "meaning get all the data from the flights table."], [1165.13, "If I press Return nothing happens."], [1167.14, "I don\u0027t see anything."], [1168.19, "There is no data that happens to be here."], [1170.74, "But now I could say something like INSERT into Flights."], [1174.353, "Then I\u0027ll provide in parentheses the names of the columns."], [1176.77, "And on the slide a moment ago I showed this on multiple lines."], [1179.388, "That was just for visuals sake."], [1180.68, "These commands can be entirely on one line if we would like it to."], [1183.66, "So I can say origin, destination, and duration and then provide values."], [1188.53, "I can say let\u0027s add New York to London, and I\u0027d"], [1192.54, "like for this flight to be duration of 415 minutes."], [1196.57, "So I type in the command, press Return."], [1198.6, "That adds a new row to my flights table."], [1201.63, "I can verify this by running SELECT * from flights."], [1206.25, "And I see that now I have this table whose id is one--"], [1209.34, "that\u0027s the id column from New York to London--"], [1212.85, "with a duration of 415 minutes."], [1215.31, "I could do this again and again."], [1216.77, "I, in advance, prepared a couple of INSERT"], [1218.52, "queries just to give us a little bit more data."], [1220.86, "Each of this is just a different INSERT query"], [1223.6, "that\u0027s going to add one new flight into our database."], [1226.54, "So I\u0027ll go ahead and copy those and then into the database"], [1229.26, "I\u0027ll go ahead and paste in all these INSERT commands"], [1231.57, "to insert a whole bunch of flights into this database."], [1234.93, "Now if I run SELECT * from flights what I get is all of the flights."], [1240.42, "This is not formatted particularly nicely."], [1242.36, "SQLite has some additional tricks if you\u0027d like to format it a little nicer."], [1245.59, "So I can say, go ahead and put this into columns mode,"], [1248.91, "and it gives me some headers."], [1251.19, "So .headers yes."], [1254.22, "And now if I SELECT * from flights, the data"], [1256.96, "is organized a little more nicely where things are really into columns"], [1259.89, "and there are headers for each of the rows."], [1261.682, "Where I can see that I kind have a text-based representation of what"], [1265.43, "I was displaying graphically a moment ago."], [1267.18, "That inside of my flights table I have four columns-- an id column, origin,"], [1271.42, "destination, and duration."], [1273.09, "Each flight is just one of the rows that\u0027s inside of this table."], [1278.31, "Now I can begin to run additional SELECT queries."], [1280.93, "If I want to do something like SELECT * from flights where origin= \"New York,\""], [1288.12, "well then instead of getting back all of the flights,"], [1290.73, "I\u0027m only going to get back the flights where the origin is New York."], [1293.7, "So I can very quickly filter down on this data,"], [1296.34, "only getting the information that I actually care about taking a look at."], [1299.79, "There are other ways of interacting with SQLite as well,"], [1302.22, "but this SQLite prompt is a very direct way"], [1304.44, "of just being able to write a query very quickly"], [1306.63, "and see the results of that query."], [1309.465, "So it turns out, there are other types of queries we can run as well."], [1312.34, "So we\u0027ll take a look at some others."], [1313.84, "We don\u0027t just need to say where something equals something else."], [1317.13, "Other types of Boolean expressions are allowed as well."], [1319.89, "So I could say something like SELECT * from flights"], [1322.8, "where duration is greater than 500."], [1325.21, "Where the idea here is let\u0027s look at the duration column."], [1328.02, "It\u0027s an integer, so we can do arithmetic expressions on these values."], [1332.13, "I can take a value and see if it\u0027s greater than 500 or not."], [1335.63, "When I do that, what I get back is all of the rows that have"], [1338.25, "a duration that\u0027s greater than 500."], [1340.59, "I can begin to query not just on whether one value equals"], [1343.56, "another value, but also other types of comparisons as well."], [1347.52, "Much as in Python, as when we had Boolean expressions in Python,"], [1350.64, "I could join multiple Boolean expressions together"], [1353.31, "using words like AND and OR."], [1355.71, "SQL has the same type of thing in its own query syntax, too."], [1359.31, "I could say something like SELECT * from flights where duration is greater than"], [1363.3, "500 AND destination= \"Paris.\""], [1366.36, "As you might logically intuit this means,"], [1368.46, "this means get me all the flights that are going to Paris"], [1371.43, "and that take longer than 500 minutes."], [1373.59, "It turns out there\u0027s only one such row inside this table that"], [1376.86, "satisfies both of those constraints."], [1379.83, "Of course, instead of using AND I could\u0027ve also"], [1381.96, "used OR to get a different query where now I\u0027m looking for all of the flights"], [1388.08, "longer than 500 minutes or the destination is Paris."], [1391.89, "So as long as either of those conditions are met, I\u0027m going to get results back."], [1395.82, "So what I get back are some of the rows where the destination is Paris,"], [1399.18, "some rows where the destination isn\u0027t Paris,"], [1401.19, "but the duration is more than 500 minutes,"], [1403.93, "and of course any row that satisfies both of these constraints."], [1407.16, "In particular, flight id number 2."], [1409.86, "That gets resulted as well when I run this particular query on this table."], [1415.888, "There are other types of queries I can perform in addition to that."], [1418.68, "So I can say something like SELECT * from flights"], [1421.05, "where origin is in-- and then in parentheses-- in \"New York\""], [1424.02, "comma \"Lima\" to say, check if the origin is in this sequence of possible values."], [1428.25, "The sequence of New York and Lima, as long as it is one of those two, then"], [1432.3, "I want for the results to come back."], [1434.04, "So then you\u0027ll get back rows that have an origin of New York, rows"], [1437.4, "that have an origin of Lima, as well."], [1439.08, "So you can begin to construct more sophisticated queries that"], [1442.41, "are able to check for whether an origin is in a list of possible values"], [1445.77, "or even if it matches a particular pattern."], [1448.74, "That maybe you know that one of the columns looks a certain way"], [1451.44, "or is formatted according to a particular structure,"], [1453.607, "but you don\u0027t know exactly what the value is."], [1456.55, "I could run a query like SELECT * from flights where origin--"], [1460.53, "not equals-- but where origin is like--"], [1463.89, "and then in quotation marks, I have a bit of a strange expression \"%a%\""], [1469.38, "This percent stands for a wild card."], [1472.45, "And this time the wild card is looking at the values of a particular column."], [1475.93, "In this case, the value of the origin column, meaning the percent"], [1479.13, "stands for zero or more characters, no matter what those characters are."], [1482.94, "We\u0027re looking for some number of characters-- maybe zero maybe more--"], [1486.03, "followed by an A, followed by some other number of characters--"], [1489.09, "maybe zero maybe more."], [1491.26, "And ultimately what this query is going to do"], [1493.65, "is look inside of the flights table and get back to me"], [1496.62, "all of the results where there is an A the origin."], [1500.16, "As long as there is an A in the origin column,"], [1502.29, "doesn\u0027t matter if there are characters before it or characters after it,"], [1505.29, "all of the rows that come back are going to be the rows that"], [1508.11, "just so happened to have an A in it."], [1510.99, "So lots of ways we can begin to run SELECT queries."], [1513.36, "And there are even additional functions you can add to your select queries"], [1516.443, "as well."], [1517.2, "If instead of just selecting the values of columns,"], [1519.66, "I want to compute the average duration of a particular category of flights,"], [1523.488, "or I want to count how many flights that are coming out of New York, or I"], [1526.53, "want to find the longest flight that goes to London,"], [1528.72, "or the shortest flight that goes to London,"], [1530.58, "or I want to add up all of the durations for a whole bunch of flights."], [1533.497, "Maybe there are flights that are connected to each other"], [1535.83, "and I want to add up the total travel time that might take."], [1538.44, "SQL has a number of built-in functions that"], [1540.75, "allow us to perform these sorts of calculations, as well."], [1544.413, "So a couple of different SQL commands we\u0027ve now taken a look at."], [1547.08, "We\u0027ve taken a look at Create Table that allows us to create a new table."], [1550.95, "INSERT that lets us add data to a table."], [1553.77, "SELECT, which lets us take data inside of the table and retrieve it."], [1557.497, "But, of course, often when we\u0027re dealing with databases,"], [1559.83, "the data doesn\u0027t just get added."], [1561.27, "The data changes in some way."], [1563.17, "So we also need some way of being able to update data after it\u0027s already"], [1566.7, "inside of our database."], [1568.84, "There\u0027s another query for that, which is an Update command that we"], [1571.74, "can execute on our database."], [1573.66, "And that command looks something like this."], [1575.52, "Again displayed on multiple lines, but you could put this entirely just on one"], [1579.05, "line."], [1579.55, "SQL doesn\u0027t really care if you add line breaks."], [1582.053, "It just knows that when it sees a semicolon at the end of the command,"], [1584.97, "that is the end of this particular command."], [1588.06, "But here what I\u0027ve said is used the Update keyword"], [1590.91, "to say I would like to update a table."], [1593.153, "What table would I like to update?"], [1594.57, "I\u0027d like to update the flights table."], [1596.91, "What would I like to do?"], [1598.38, "Well I\u0027d like to set the duration equal to 430."], [1602.67, "So whatever the value of duration happens to be right now,"], [1605.37, "change it to 430."], [1607.41, "But of course I don\u0027t want to change it to 430 for every single flight."], [1611.16, "Just as in a SELECT clause, I could say WHERE something = something or WHERE"], [1614.89, "and then some other clause to specify where"], [1617.46, "I want the rows to be selected from."], [1619.6, "Likewise, to an Update I can say set duration equal to 430"], [1623.82, "WHERE a particular condition is true."], [1626.11, "So here I\u0027m going to look through the flights table,"], [1628.56, "find myself all of the flights where the origin is New York"], [1632.16, "and the destination is London."], [1634.5, "For those rows I\u0027m going to update the value of the duration column"], [1638.01, "setting the duration column equal to 430."], [1640.92, "So using that syntax I can take data and update it,"], [1643.53, "changing one value to another value by pinpointing which row or rows I"], [1647.85, "would like to change."], [1648.84, "If I only want to change one row, I might do Update flights SET duration="], [1653.61, "something WHERE id= a particular id."], [1656.94, "To be able to pinpoint one id and then take that row"], [1660.3, "and make some modification to it."], [1662.76, "In addition to inserting data, selecting data, and updating data,"], [1666.07, "the last main command we\u0027ll concern ourselves with"], [1668.31, "is the ability to delete data."], [1669.848, "The ability to take a row and say, I\u0027d like to get rid of it."], [1672.39, "Or take multiple rows and get rid of them."], [1674.7, "And so a command like delete from flights, where destination= \"Tokyo\""], [1679.11, "as you might imagine deletes from the flights table all of the rows that"], [1682.65, "satisfy this condition where the destination is equal to Tokyo."], [1687.132, "So a number of different operations now that we have the ability to do."], [1690.09, "The ability to delete from a particular table where a condition is true,"], [1693.69, "the ability to update a table based on particular conditions, the ability"], [1697.14, "to select data from a table, and insert data into a table as well."], [1701.76, "There are a couple other clauses that can be used to add SQL queries as well."], [1705.57, "Just to add additional functionality."], [1707.85, "If I don\u0027t want all of the rows to come back from a particular SQL query,"], [1711.45, "I can limit the results that come back."], [1713.49, "So normally SELECT * from flights would get me"], [1716.16, "all of the flights inside of the table."], [1718.32, "But I could say SELECT * from flights, LIMIT 5 to just say,"], [1722.22, "I only want five results to come back from this table."], [1726.12, "ORDER BY allows me to decide how the results are ordered inside the results"], [1730.14, "to come back."], [1730.98, "So I can say SELECT * from flights, ORDER BY destination, or ORDER BY"], [1734.97, "duration to get all of the flights in order by how long they are."], [1738.87, "GROUP BY allows me to group a whole bunch of rows together."], [1742.84, "So if I wanted to group all of the flights by their origin"], [1745.753, "so I can get all of the flights leaving New York and all the flights leaving"], [1748.92, "London and so forth, I could do something like SELECT *"], [1751.65, "from flights GROUP BY origin to group flights by their origin as well."], [1756.48, "HAVING is a constraint I can place on GROUP BY"], [1759.21, "to say that I would like to select all of the flights grouping them"], [1763.83, "by their origin, but they need to have a count of at least three."], [1767.1, "Meaning there needs to be at least three flights that"], [1769.65, "are leaving from that particular city."], [1772.23, "For all of these particular clauses, these"], [1774.06, "are helpful to know if you\u0027re going to be directly writing SQL."], [1776.7, "We won\u0027t worry about them too much here, in particular"], [1779.01, "because fairly shortly we\u0027re not going to be writing SQL ourselves."], [1782.1, "We\u0027re going to just be writing Python code"], [1784.23, "and Django is going to, under the hood, be manipulating the database"], [1787.5, "and creating the SQL commands that it is going"], [1789.93, "to run on the underlying database."], [1792.02, "So we will see how we don\u0027t actually need to worry"], [1794.31, "about writing the specific syntax."], [1796.11, "But Django is going to handle much of that for us."], [1800.08, "So here now we have a flights table, a table"], [1802.5, "that keeps track of all of the flights that we have,"], [1804.96, "organizing them by their id and their origin and their destination"], [1808.5, "and their duration."], [1809.7, "But oftentimes when we\u0027re dealing with data, especially in a larger database,"], [1813.31, "we don\u0027t just have one table of data."], [1815.46, "We have multiple tables of data."], [1817.33, "And those multiple tables might relate to each other in some way."], [1821.528, "Let\u0027s take a look at an example of how that might come about."], [1824.07, "We\u0027re going to introduce a concept that will call foreign keys,"], [1826.77, "and we\u0027ll see what that means in just a moment."], [1829.54, "So here again is our flights table."], [1831.69, "The flights table has four columns-- an id, origin, destination, and duration."], [1837.27, "But of course in New York, there are multiple airports."], [1841.215, "And so it might not make sense for me to just"], [1843.09, "label each origin or each destination just by the name of the city."], [1846.84, "Maybe I also want to give the three letter airport"], [1849.54, "code that corresponds to the airport to which I\u0027m referring in this case."], [1854.07, "So how would I encode into this table, not only the origin, but also"], [1857.73, "that city\u0027s airport code?"], [1859.17, "And not only for the destination the name of the city,"], [1861.43, "but also the airport code for that airport as well?"], [1864.45, "Well I could just add more columns."], [1866.45, "I could say something like, all right, now"], [1868.2, "we have this table that has an id, an origin, an origin code, a destination,"], [1874.53, "a destination code, and a duration."], [1877.41, "But here now, the table is starting to get fairly wide."], [1881.05, "There are a lot of columns here and in particular, there"], [1883.73, "is some duplicate data."], [1887.1, "Paris is associated with this particular three letter"], [1890.01, "code, and the same thing for New York and other airports as well."], [1893.68, "There is some messiness in the structure of this data."], [1897.33, "Often what we\u0027ll want to do as we begin to deal"], [1899.34, "with data in larger and larger sets with more and more columns"], [1902.52, "is we\u0027ll want to normalize this data."], [1904.41, "Separating things out into multiple different tables that"], [1907.71, "just reference one another in some way."], [1910.85, "So instead of just having a single flights table what we might consider"], [1914.13, "doing is saying that flights are one type of object"], [1917.61, "but another type of object that I care about is an airport."], [1921.36, "So I might just have a separate table just for airports"], [1924.27, "where this table has three columns."], [1926.48, "A column for the ID of the airport, just some unique number"], [1929.22, "that can identify a particular airport."], [1931.44, "One column for the three letter code for that airport,"], [1934.29, "and one letter for the city, or one column"], [1936.36, "for the city where that airport is in."], [1939.06, "Now this is a much more straightforward, simpler representation"], [1942.21, "of all of the airports."], [1943.92, "The question becomes what happens to my flights table?"], [1947.1, "My flights table that here had an id, an origin, destination, and duration where"], [1952.41, "the type of origin and destination were in this case just text."], [1956.61, "Text-based data representing the name of the city"], [1959.7, "from which the flight is departing or to which the flight is arriving."], [1963.74, "Well now that I have the separate airports"], [1965.49, "table where every row in the airports table"], [1967.95, "has its own unique id, then what I can do in this case is,"], [1971.44, "instead of storing an origin and a destination as text,"], [1974.7, "I can store what we\u0027ll call a foreign key."], [1976.95, "A reference to a key in another table and rename these columns"], [1980.73, "to origin id and destination id."], [1984.12, "That instead of storing text are going to store a number where"], [1988.5, "origin_id 1 means the origin of flight one"], [1991.86, "is whatever airport number 1 happens to be."], [1996.2, "I could go to the airports table, look up which airport has an id of 1,"], [2001.16, "and that would tell me the origin of this flight."], [2003.39, "And if I went to the airports table and looked up which airport"], [2006.08, "had an ID of 4 that would tell me the destination of this flight as well."], [2010.41, "So by combining two different tables."], [2012.98, "One table for representing airports, and one table for representing flights."], [2017.15, "I\u0027m able to connect these two different tables together"], [2020.51, "by way of a foreign key."], [2021.71, "Some columns inside of my flights table, namely the origin id column"], [2025.7, "and the destination id column that together"], [2028.22, "allow me to reference information stored inside of another table as well."], [2032.84, "As you imagine this sort of airlines database"], [2035.33, "growing and storing more different kinds of data,"], [2037.61, "the ability to relate tables to each other"], [2040.09, "is going to become incredibly powerful."], [2042.187, "So one thing you might imagine is that in addition"], [2044.27, "to storing airports and storing flights, an airline probably"], [2047.63, "also needs to store information about its passengers,"], [2050.33, "like who on which flight."], [2052.42, "So you could imagine constructing a passenger\u0027s table"], [2055.4, "that has an id column to uniquely identify every passenger, a first name"], [2059.36, "column that stores every passenger\u0027s first name,"], [2061.6, "a last name column for storing their last name,"], [2063.71, "and a flight id column for storing what flight that passenger happens to be on."], [2068.79, "So in this case, I could say that Harry Potter is on flight number one."], [2072.56, "I could look that up in the flights table"], [2074.449, "to find out inside the flights table, here"], [2076.76, "is where the flight is leaving from, where it\u0027s going to"], [2079.37, "and what its duration happens to be."], [2082.31, "Now as we begin to design these tables, we"], [2084.679, "have to think about what the implications of that design"], [2087.77, "happen to be."], [2088.699, "In the case of this passenger\u0027s table, it"], [2090.679, "does seem that there is a limitation on the table design that I have created."], [2095.27, "Namely, if you think about it you\u0027ll see the limitation of this table design"], [2098.54, "is that any particular row can only have one flight id associated with it."], [2104.48, "That Harry Potter has a single flight id column"], [2107.6, "that can only have one value stored inside of it."], [2110.78, "This would seem to make it impossible to allow"], [2113.33, "for us to be able to represent a person that"], [2115.58, "could be on multiple different flights."], [2118.58, "So this starts to get at the idea of different types of relationships"], [2122.36, "that rows in a table can have to one another."], [2125.33, "One type of relationship is a many to one"], [2128.0, "relationship, or a one to many relationship,"], [2130.29, "where I express the idea that one flight can"], [2133.07, "be associated with many different passengers, for instance."], [2136.94, "But we might also want is a many to many relationship,"], [2140.64, "where many different passengers can be associated with many different flights."], [2143.91, "A passenger might have more than one flight."], [2146.33, "A flight might have more than one passenger."], [2148.82, "To do that we\u0027re going to need a slightly different structure"], [2152.09, "for this particular type of table."], [2154.28, "One way we could approach it is by creating a separate table"], [2157.7, "for storing people."], [2159.05, "I can have a people table where every person has an id, has a first name,"], [2163.22, "and has a last name same as before."], [2165.17, "But I\u0027m no longer storing flight information inside of the table."], [2168.83, "I\u0027ve cleaned my setup up."], [2170.21, "I\u0027m only storing people in this table and nothing about their flight"], [2173.57, "information."], [2174.88, "I\u0027ll have a separate table for dealing with passengers on the flight"], [2178.19, "and mapping people to their flights."], [2180.633, "We can think about what does that table need to look like?"], [2183.05, "Well I need some sort of table that is going to relate people to what flights"], [2187.4, "they happen to be on."], [2188.69, "So odds are we\u0027re going to need one column that is a foreign key that"], [2191.78, "references this people table, and we\u0027ll need another column that"], [2195.17, "is a foreign key that references the flights table, such"], [2198.14, "that I can relate those two tables together."], [2200.69, "So that table could look like this."], [2203.36, "This now is a simplified passengers table that only has two columns."], [2206.94, "It has a person id column and a flight id column."], [2210.5, "The idea of this table now is it\u0027s known as an association"], [2213.56, "table, or a joined table that just associates one value from one table"], [2217.79, "with another value from another table."], [2220.13, "This row here, one and one, means the person with an id of one"], [2224.39, "is on flight number one."], [2226.61, "I could look up that person inside of the people table,"], [2229.67, "look up that flight inside of the flights table,"], [2231.86, "and figure out who the person is and what flight they\u0027re on."], [2234.78, "Down here, two and four, means whoever the person with an ID of 2"], [2238.67, "is on whichever flight happens to have an ID of 4."], [2244.37, "So this now has allowed us to be able to represent"], [2247.19, "the types of relationships we want."], [2248.93, "We have a table for airports and a table for flights and any flight"], [2253.25, "is going to map to two different airports, one destination one origin."], [2257.39, "And any airport might appear on multiple different flights."], [2260.13, "It\u0027s sort of a one to many relationship."], [2262.73, "Then over here, when it comes to passengers,"], [2265.07, "we\u0027ve stored people inside of a separate table,"], [2267.59, "and then had a many to many mapping between people and flights"], [2270.98, "so that any person could be on multiple different flights."], [2273.8, "Like here, for example, person number two is on both flights one and four."], [2278.42, "Likewise, a flight could have multiple people."], [2280.89, "So in this case flight number six has passengers five and six"], [2284.72, "that are on that flight as well."], [2286.4, "We\u0027ve been able to represent those relationships."], [2289.74, "Of course a byproduct of doing this is that now our tables are a little bit"], [2293.75, "messier to look at."], [2295.13, "Messy in the sense that it\u0027s not immediately obvious to me,"], [2297.84, "when I look at this table, what data I\u0027m looking at."], [2300.32, "I see these numbers, but I don\u0027t know what these numbers mean."], [2303.35, "I\u0027ve separated all these tables into different places."], [2306.175, "Now it\u0027s a little harder for me to figure out who is on which flight."], [2309.05, "I have to look at this data, look up people in the people table,"], [2311.96, "look up flights in the flights table, and somehow"], [2314.18, "associate all of that information back together in order"], [2317.81, "to draw any sort of conclusion."], [2319.91, "But luckily, SQL makes it pretty easy for us"], [2322.1, "to be able to take data across multiple different tables"], [2325.43, "and join them all back together."], [2327.62, "We can do this using a JOIN query that takes multiple tables"], [2331.67, "and joins them together."], [2332.96, "So the syntax for a JOIN query might look something like this."], [2336.54, "And here we\u0027ll go back to just the two-table setup where"], [2339.02, "I have flights and passengers, where every passenger is"], [2342.2, "associated with one flight."], [2343.61, "But you could extend this and join multiple tables"], [2345.8, "to deal with our more complex example as well."], [2348.15, "But here, I\u0027d like to select every person\u0027s first name"], [2351.35, "and their origin and their destination."], [2354.17, "I\u0027m going to select that from the flights table,"], [2356.39, "but I need to join it with the passengers table."], [2359.3, "Then I say ON to indicate how it is these two"], [2361.97, "tables are related to one another."], [2363.992, "In this case, I\u0027m saying the way these two tables are"], [2366.2, "related to one another is that the flight id column of the passengers"], [2370.25, "table is associated with the id column of the flights table."], [2374.33, "The flights table has an id that uniquely identifies every flight,"], [2377.96, "and the passengers table has a flight id column"], [2380.78, "that uniquely identifies the flight that we\u0027re referring to"], [2383.9, "for this particular passenger."], [2385.64, "And so the result I might get is a table that looks like this."], [2388.34, "That gives me everyone\u0027s first name, but also"], [2390.73, "their origin and their destination."], [2392.5, "Our origin and destination are going to be drawn from that table of flights"], [2398.56, "and the first name is going to be drawn from the table of passengers."], [2401.77, "But by using a JOIN query, I\u0027ve been able to take data"], [2404.41, "from two separate tables and join them both back together."], [2408.49, "And there are a number of different types of JOIN queries that I can run."], [2411.85, "What we saw here was just the default JOIN, which"], [2414.16, "is otherwise known as an INNER JOIN."], [2416.95, "Effectively, an INNER JOIN will take the two tables,"], [2419.83, "it will cross compare them based on the condition that I specified"], [2422.77, "and only return back to me the results where there\u0027s a match on both sides."], [2426.76, "Where we match a passenger\u0027s flight id with an id in the flights table."], [2431.43, "There are various different kinds of outer"], [2433.18, "joins if I want to be OK with the idea that maybe"], [2435.79, "something on the left table that I\u0027m joining"], [2437.8, "doesn\u0027t match with anything on the right,"], [2439.508, "or maybe something on the right table doesn\u0027t match with something"], [2442.258, "on the left."], [2442.9, "But just know there are other types of JOIN queries that I can run as well."], [2447.64, "Other strategies that can be helpful when dealing with SQL tables"], [2450.68, "are optimizations we can make to make queries more efficient."], [2454.12, "One thing we can do with our tables is to create an index"], [2457.69, "on a particular table."], [2459.13, "You can think of an index as kind of like the index in the back of a book,"], [2462.83, "for example, where if you wanted to be able to search for a topic in a text"], [2466.26, "book, you could open the textbook and just page by page look for every topic"], [2470.055, "and just try and find the topic you\u0027re looking for."], [2472.18, "But often what you\u0027ll be able to do if the table has"], [2474.67, "an index is go to the index of the book, find the topic you\u0027re looking for,"], [2479.45, "and that will quickly give you a reference for how"], [2481.6, "to get to the right page in question."], [2483.73, "An index on a table operates in much the same way."], [2486.37, "It is an additional data structure that can be constructed,"], [2489.64, "and it does take time and memory to be able to construct this data structure"], [2492.82, "and to maintain it anytime you update the data inside the table."], [2496.55, "But once it exists it makes querying on a particular column much more"], [2500.92, "efficient."], [2501.58, "You can very quickly look something up in the index"], [2504.34, "and find the corresponding rows that go along with it."], [2507.41, "So here we can have a command like create an index that we\u0027re"], [2510.48, "going to call name index on the passengers table,"], [2513.91, "and in particular on the last name column."], [2517.63, "I expect that as I query this table, I\u0027m pretty frequently"], [2520.96, "going to be looking up passengers by their last name."], [2523.82, "So I would like to create an index on that table"], [2526.36, "to be able to more efficiently search for a passenger"], [2529.39, "based on their last name as well."], [2532.28, "So that\u0027s just a general overview of what SQL syntax is all about."], [2535.71, "A syntax that we can use to be able to create data tables inside of which"], [2539.83, "are storing rows of data where every row consists of some number of columns,"], [2544.09, "and every column has a type."], [2545.76, "We have the ability to create tables, add data to them,"], [2548.65, "update, delete, and get data out of those tables as well."], [2551.95, "But as we begin to introduce these new technologies,"], [2554.32, "there are always risks and potential threats"], [2556.51, "that are associated with those technologies as well."], [2559.36, "In SQL, the key one to be aware of is what\u0027s known as a SQL injection attack."], [2564.37, "A security vulnerability that can happen if you\u0027re not"], [2566.8, "careful about how it is you actually execute your SQL commands."], [2570.878, "So where might this come about?"], [2572.17, "You might imagine for instance, that if a database has some number of users,"], [2576.02, "you might be storing those users inside of a database."], [2579.49, "For instance, in a users table where there\u0027s a user name"], [2582.13, "column and a password column."], [2583.83, "Though, in practice you probably wouldn\u0027t"], [2584.95, "want to store passwords and clear text, let\u0027s"], [2586.87, "imagine here for example that you are storing usernames and passwords inside"], [2590.74, "of a table."], [2592.09, "We have a log in form for a website that looks"], [2594.25, "like this, where you get to type in your username and your password."], [2597.395, "So if someone types in their username and password,"], [2599.52, "what might happen is that the web application might look SELECT * FROM"], [2603.55, "users, where username= this particular user name highlighted here."], [2608.08, "We\u0027re just going to substitute the user name right there."], [2610.57, "And password= and we\u0027ll substitute the password over there."], [2614.442, "So if someone tries to log into our site,"], [2616.15, "like Harry logs in with a password of 12345, what we might do"], [2620.44, "is run this SELECT query."], [2622.09, "Say SELECT * FROM users where username is \"Harry\""], [2625.54, "and where the password is 12345."], [2628.66, "Our logic might be if we get results back,"], [2630.97, "then that means there is a user whose username is Harry and password is 12345"], [2635.89, "and we can go ahead and sign that user in."], [2639.1, "But imagine now what might happen if instead,"], [2642.46, "the user who typed in a username of hacker\"--."], [2647.95, "Seems like a bit of a strange username to type in."], [2650.202, "It doesn\u0027t matter what they put in their password here now."], [2652.66, "The result might be that what they would plug into the username is where"], [2656.11, "username=\"hacker\" and then the - -."], [2659.29, "It turns out --"], [2660.52, "in SQL stands for a comment in SQL."], [2662.68, "It just means ignore everything that comes after it in the same way that"], [2665.68, "in Python you can use the hashtag symbol to mean the rest of this line is"], [2669.34, "a comment, and the compiler-- whoever is running the program--"], [2671.98, "should just ignore it."], [2673.1, "So everything after the - - kind of gets ignored."], [2676.51, "We\u0027ve effectively been able to bypass the password check."], [2679.39, "Someone could bypass a password check and log into an account"], [2683.08, "even if they were unauthorized to do so."], [2685.24, "So here is a vulnerability within the SQL syntax."], [2688.72, "If we\u0027re not careful about when we\u0027re running SQL syntax,"], [2691.49, "we could be running untrusted SQL commands"], [2694.35, "that some hacker or some adversary has been able to plug-in to our program."], [2698.9, "So how do we solve this sort of problem?"], [2700.93, "One strategy is to escape these characters."], [2703.75, "Escaping just meaning add some back slashes"], [2706.27, "that just makes sure that SQL knows to treat these as a literal quotation"], [2709.84, "mark and a literal dash, and not special SQL syntax of any sort."], [2713.98, "Another strategy is to use an abstraction layer on top of SQL"], [2717.55, "so that we don\u0027t have to write the SQL queries at all."], [2719.8, "That\u0027s in fact what we\u0027re about to do as we transition to the world of Django"], [2723.64, "to take a look at how when we begin to use a web framework like Django,"], [2727.0, "we now have the ability to not worry about the nuances of the syntax of SQL"], [2731.53, "and just deal a little more high level with what our models are."], [2734.415, "What the types of objects are that we\u0027re dealing with and interacting"], [2737.29, "with inside of this application."], [2740.32, "One other concern worth noting about with regards to SQL"], [2743.26, "is the possibility of race conditions."], [2745.51, "A race condition is something that might happen"], [2747.97, "anytime you have multiple events that are happening in parallel threads,"], [2751.78, "so to speak."], [2752.32, "That you have one thing happening and another thing happening simultaneously."], [2756.07, "You might imagine that in the case of social media sites"], [2759.19, "where you can like a post, like an image on Instagram or a tweet on Twitter,"], [2762.59, "for example."], [2763.58, "What would happen if two people tried to like the same post at the same time?"], [2768.61, "If we\u0027re not careful about how we run those particular SQL queries"], [2771.88, "there\u0027s a potential for us to be able to get race condition problems,"], [2776.53, "where we end up trying to query for the number of likes that a post has"], [2780.1, "and then another person tries to do the same thing"], [2782.378, "and there are conflicts when we try and update it"], [2784.42, "where the result might not be what we would expect it to be."], [2787.35, "There are a number of unexpected results that"], [2789.31, "can happen when we deal with problems related to race conditions"], [2792.61, "where multiple things are happening simultaneously."], [2795.44, "How do we solve those problems?"], [2796.93, "Well, one strategy is to sort of place a lock on the database."], [2800.23, "To say, while I\u0027m working on this database nobody else"], [2803.11, "can touch this data."], [2804.29, "Let me finish this transaction, so to speak."], [2806.58, "Finish working on this particular transaction and making all the changes"], [2809.89, "I need to make to the database."], [2811.36, "Only after I\u0027m done I can release the lock and let someone else go ahead"], [2815.62, "and modify the database as well."], [2817.72, "So a number of concerns to be aware of as we"], [2820.09, "begin dealing in this world of SQL and trying to work with databases."], [2825.52, "So now that we\u0027ve taken a look at the syntax of SQL,"], [2827.8, "understanding how these tables work, how they\u0027re structured,"], [2830.83, "and what it is that we can add to those tables,"], [2833.06, "let\u0027s go ahead and turn our attention in particular to Django"], [2836.11, "models, which are a way of representing data inside of a Django application."], [2840.208, "Because where Django is really going to get powerful in designing our web"], [2843.25, "applications is the ability to represent data in terms of these models."], [2847.718, "So we\u0027re going to go ahead and try to create a web application that"], [2850.51, "is going to represent what an airline might want to store inside"], [2854.41, "of its own web application."], [2857.11, "All right."], [2857.61, "So the first thing I want to do is create a Django project."], [2860.77, "So I\u0027ll go ahead and type Django-admin START PROJECT"], [2863.725, "and the name of my project will just be called \"airline.\""], [2866.1, "I\u0027m creating a project for an airline\u0027s website for example."], [2869.47, "I\u0027ll go ahead and go into the airline directory,"], [2871.53, "open that up in my code editor."], [2873.31, "Before I actually begin editing any code,"], [2875.68, "remember that every Django project needs to have one or more apps within it."], [2880.0, "So the first app that I\u0027ll create for this airline"], [2882.61, "is an app for keeping track of flights."], [2885.76, "So keeping track of flight related information,"], [2888.46, "like origins and destinations and durations"], [2890.77, "and what passengers are on those flights."], [2893.68, "When I create a new app, first thing I\u0027ll need to do"], [2896.65, "is go into settings.py inside of airline,"], [2899.53, "and go ahead and add this app as an installed app."], [2902.89, "So \"flights\" is now an app that I have installed."], [2906.04, "Then what I\u0027ll want to do is say, go ahead and go into urls.py, which is,"], [2912.702, "again, that table of contents for all the"], [2914.41, "URLs I can get to for this particular web application."], [2916.87, "I\u0027ll IMPORT include, because I want to do is when someone visits the path"], [2921.16, "of flights/ something, I want to take them to flights.urls,"], [2926.72, "mapping them to the urls.py file that will be inside of my \"flights\""], [2931.54, "application."], [2932.95, "Of course, now I need a urls.py file inside of my \"flights\" application."], [2936.96, "So I go into \"flights\" and create a new file that I\u0027ll call urls.py."], [2943.87, "We can do from FROM.django.urls IMPORT path FROM .IMPORT views."], [2949.21, "And then my URL patterns are going to go inside of this list right here."], [2954.11, "But before I begin dealing with actual URLs,"], [2956.26, "the first thing I\u0027m going to want to do is create some models."], [2959.54, "Models are going to be a way of creating a Python class that"], [2962.47, "is going to represent data that I want Django to store inside of a database."], [2967.09, "So when I create a model, Django is going"], [2968.86, "to figure out what SQL syntax it needs to use it to A-- create that table"], [2972.94, "but then B-- manipulate that table."], [2974.74, "Selecting and updating and inserting anytime I make changes to those models."], [2979.45, "So here what I can do is inside of every app that gets created--"], [2982.99, "in this case called \"flights\"-- there is a models.py file."], [2986.34, "We haven\u0027t looked at this before, but this"], [2988.09, "is going to be the place where we get to define what models"], [2991.07, "are going to exist for our application."], [2993.86, "Every model is going to be a Python class."], [2996.17, "You can think of this as having one model for each of the main tables"], [2999.56, "we care about storing information about."], [3002.18, "So let me define a new class called \"flight\""], [3004.6, "that is going to inherit from models dot model some creating a new class"], [3008.08, "called \"flight\" that is going to be a model."], [3011.83, "Then I need to provide inside of this class all of the parameters"], [3015.52, "that a flight has."], [3016.29, "What properties does a flight have that I might want to keep track of?"], [3020.05, "Well, a flight has an origin."], [3022.18, "And the origin is going to be a models.charfield."], [3025.69, "This is all documented on Django\u0027s website"], [3027.52, "in terms of the various different types of fields that exist that I"], [3030.82, "can include inside of a Django model."], [3033.07, "Where here I\u0027m saying here is a character field"], [3035.78, "whose max length is going to be 64."], [3039.12, "I assume that most city names are not going to go longer than 64 characters."], [3042.46, "That seems like a reasonable maximum length for the origin of the flight,"], [3046.18, "for example."], [3047.5, "Every flight will also have a destination,"], [3049.48, "which will be a character field whose max length is also 64."], [3053.89, "Every flight will have a duration, which will just be an integer field."], [3058.57, "So now this is my very first Django model."], [3061.6, "It is a class called \"flight\" where I\u0027ve defined all of the properties"], [3065.47, "that a flight has, and then using Django syntax to find"], [3068.32, "what type they should have as well."], [3069.88, "Every flight has an origin, has a destination, and has a duration."], [3075.19, "But of course nothing here is actually modified"], [3077.26, "the database the Django is using in order to store information"], [3081.19, "about my web application."], [3082.39, "And we can see if we, in fact go back to airline,"], [3084.71, "and I type LS, what you see here is that there isn\u0027t yet a database that exists."], [3090.32, "I just have an airline directory, a flights directory,"], [3093.01, "and a manage.py file."], [3095.53, "So what I\u0027d like to do is somehow tell Django"], [3098.59, "that you should update the database to include information about the models"], [3102.76, "that I have just created."], [3104.26, "This is a process that we refer to in Django and more generally as"], [3107.41, "migrations."], [3108.65, "I create a migration to say, here are some changes"], [3111.7, "that I would like to apply to the database."], [3114.07, "Then I migrate them to tell Django to take those changes"], [3117.67, "and actually apply them to the database."], [3119.85, "So it\u0027s a 2-step process."], [3121.18, "One is creating the migration, the instructions for how to actually go"], [3125.11, "about manipulating the database."], [3126.61, "And then one to take that migration step of saying now take those instructions"], [3130.9, "and actually apply them to the underlying database."], [3134.8, "We can make the migrations via command."], [3137.32, "Again we\u0027ll use the manage.py script that has a number of different commands"], [3140.98, "that allow us to control various parts of the application."], [3143.83, "I\u0027ll use python manage .py and then MAKE migrations."], [3149.29, "Now what we see is we\u0027ve created a migration inside of 0001_initial.py"], [3155.59, "where in this migration it\u0027s created a model called \"flight.\""], [3160.65, "So if I go ahead and look at the migrations directory,"], [3163.87, "I see this file has been created for me."], [3166.76, "I didn\u0027t have to create it myself."], [3168.61, "This file has instructions to Django for how"], [3172.33, "to manipulate the database to reflect the changes I have made to the model."], [3176.8, "Here is an instruction to Django to create a new model called"], [3180.55, "\"flight\" that has these particular fields inside of it."], [3184.3, "It\u0027s basing this off of the changes that I made to models.py."], [3187.69, "The model that I added is now reflected in this migration."], [3192.28, "Now if I want to apply the migration, actually apply it to Django\u0027s database,"], [3196.75, "I can run python manage.py MIGRATE to go ahead and apply these migrations."], [3202.292, "There are a bunch of default migrations that get applied as well,"], [3205.0, "but notice that one of the migrations that gets applied is this one here."], [3208.87, "Applying flights.0001_initial to say let\u0027s go ahead and apply that"], [3213.97, "migration, create that table that is going to represent flights."], [3218.5, "If I type LS now, you\u0027ll see that now I have a db.sqlite3 file."], [3223.87, "A SQLite database that is going to contain a table that"], [3227.59, "is going to store all of my flights."], [3230.417, "And so how can I actually begin to manipulate this data?"], [3232.75, "How can I interact with these sorts of models?"], [3236.47, "I could use direct SQL syntax by opening up this database file"], [3239.98, "and running commands, but Django provides some nice abstraction layers"], [3243.49, "on top of it so that I don\u0027t actually need to execute those commands myself."], [3247.12, "I can begin to work more generally with Python classes and variables and things"], [3251.53, "that I\u0027m used to inside the Python language."], [3254.41, "So I can enter Django\u0027s shell where I can just run Python commands"], [3258.167, "by running python manage.py shell."], [3262.75, "What this does is open up a shell or a console"], [3264.67, "where I can begin to write Python commands that"], [3267.7, "get executed on this web application."], [3270.37, "The first thing I\u0027d like to do is from flights.models"], [3274.36, "let me just import flight."], [3277.02, "So \"flights\" is the name of my app."], [3278.5, "\"Models\" is the name of that file."], [3280.24, "I\u0027m importing the flight class from that models file that I\u0027ve just created."], [3284.77, "Now what I can do is I can create a new flight."], [3288.31, "I can say something like f= a flight whose origin is \"New York\""], [3294.19, "and whose destination is \"London\" and whose duration= 415 minutes."], [3300.82, "And then I can say f.save to save that new flight that I have created."], [3305.262, "This syntax-- I\u0027ll go ahead and make it a little bit bigger so you can see it"], [3308.47, "a little easier--"], [3309.46, "is my way of inserting data into this table."], [3313.13, "I don\u0027t need to use an INSERT query in SQL."], [3315.52, "I just have to write a Python command, and Django knows that when"], [3318.61, "I create a new flight and save it, that it should run an instant command"], [3322.75, "on the underlying SQL tables."], [3324.34, "Where here I\u0027ve created a new flight with this particular origin"], [3327.91, "and destination and duration and I\u0027ve gone ahead and saved that flight as"], [3332.02, "well."], [3333.06, "If I want to query that flight, get information about that flight,"], [3336.16, "I can say something like, flight.objects.all"], [3340.24, "is the equivalent of a Select-All."], [3342.01, "Get me all of the flights that exist inside of my database."], [3346.39, "Here I see I get back a query set, which is just a set of results."], [3350.74, "Here I have one flight that came back, flight object 1."], [3354.07, "So a flight has been created for me with ID 1."], [3356.83, "Now \"flight object 1\" probably not all that helpful of a name."], [3359.95, "It\u0027d be nicer if this model had a cleaner"], [3362.11, "way of seeing the name of a particular flight, for example."], [3366.34, "And it turns out we can do that."], [3368.14, "Any model-- I\u0027ll go back to the code inside of models.py--"], [3371.68, "any model can implement double underscore str"], [3375.52, "function, which returns a string representation"], [3379.72, "of that particular object."], [3381.61, "This applies not just to Django models but to Python classes more generally."], [3385.09, "That if this function returns a string representation of the object,"], [3388.4, "let\u0027s go ahead and return a formatted string that is self.id"], [3393.1, "I\u0027ll say self.origin to self.destination."], [3397.42, "So here what I\u0027ve said is that the string representation of any flight"], [3401.53, "is going to be a string that gives its ID and then says origin to destination."], [3406.03, "Just a nice clean name that is going to represent this particular flight."], [3410.8, "So now if I go back to the shell by running python manage.py shell,"], [3417.15, "I can say from flights.models import Flight."], [3420.658, "I can say, all right, let\u0027s let a variable called"], [3422.7, "flights be equal to flight.objects.all."], [3426.36, "And now flights is going to be this flight, flight 1, New York to London."], [3431.76, "It now has a much nicer, string representation"], [3433.98, "of the name, which just makes it a little bit easier to interact with."], [3437.67, "If I wanted to get just that one flight, I can say flight equals flights.first."], [3443.01, "Flights is a query set."], [3444.48, "First gets me that first flight."], [3446.92, "And so now, I have this flight from New York to London."], [3450.42, "And just as in any Python object, I can begin"], [3452.55, "to access properties of that object."], [3454.73, "I can say, all right, flight, what is your ID?"], [3456.99, "Flight, what is your origin?"], [3458.76, "Flight, what is your destination?"], [3460.2, "Flight, what is your duration?"], [3461.83, "And I can access, as values, all of the properties of this flight"], [3465.37, "that I ultimately care about."], [3466.59, "And if I want to delete the flight, I can say something like flight.delete."], [3471.72, "Now, ultimately though, this is not the model"], [3474.51, "that I actually want to represent my flight."], [3476.61, "Because here again, I\u0027m using a character field, a char field,"], [3480.09, "for things like origin and destination."], [3482.01, "When in reality, I\u0027d probably like to use something like another table"], [3486.39, "for representing airports, and then some relationship"], [3489.75, "between every flight and an airport."], [3492.09, "So let\u0027s go ahead and try and implement that idea now,"], [3494.55, "that I can go back into models.py and create a new class."], [3498.84, "I\u0027ll create a class called airport."], [3501.24, "That is also a model."], [3503.01, "And I\u0027d like for this airport class to have"], [3505.53, "a code, which is a character field with a max length of 3,"], [3510.96, "for the airports code."], [3512.43, "As well as a city, which would be a character field"], [3514.92, "with a max length of 64."], [3517.71, "And let\u0027s also give this airport a string representation."], [3521.5, "We\u0027ll say that the string representation of an airport"], [3523.89, "will just be the city of the airport, and then in parentheses,"], [3528.18, "the code of the airport."], [3529.28, "So it will be something like New York, and then in parentheses"], [3531.863, "JFK to represent a particular airport."], [3536.01, "And now, our flight model needs to change a little bit."], [3539.28, "No longer will origin and destination be character fields"], [3542.55, "that are just storing text."], [3544.08, "But instead, origin is going to be a foreign key."], [3548.91, "A foreign key that references another table, like the airport table."], [3554.067, "And then, I can provide some additional arguments."], [3556.15, "So this alone would be enough."], [3557.5, "But I can add some additional arguments like on delete equals models.cascade."], [3563.07, "So what does this mean?"], [3564.28, "Well, when I have tables that are related to each other,"], [3567.332, "SQL needs some way of knowing what should"], [3569.04, "happen if you ever delete something."], [3570.87, "If I have a flight from JFK to London, and later in time"], [3575.94, "decide to delete JFK airport from my database,"], [3578.73, "what should happen to that flight?"], [3580.38, "What happens to flights when the thing that it is referencing gets deleted?"], [3584.82, "What models.cascade means is if I were to ever delete"], [3587.76, "an airport from the airports table, it\u0027s going to also delete"], [3591.3, "any of the corresponding flights."], [3593.037, "And there are other on delete parameters you"], [3594.87, "can set for saying like, don\u0027t even let me delete an airport"], [3597.44, "if there are flights that are leaving from"], [3599.19, "or going to that airport, that\u0027s called models.protect."], [3602.25, "But there are other ways of implementing similar types of constraints."], [3606.66, "And the other argument that I\u0027m going to provide"], [3608.7, "is what\u0027s called a related name."], [3611.19, "And a related name, as we\u0027ll see in just a moment,"], [3613.53, "is going to be a way of me accessing a relationship in the reverse order."], [3618.0, "That from a flight, I can take a flight and say .origin to get"], [3622.17, "the flight\u0027s origin in airport."], [3623.818, "But the other question I might want to ask is in the reverse order."], [3626.61, "If I have an airport, how do I get all of the flights that"], [3630.21, "have that airport as an origin?"], [3632.04, "And so here, if I give a related name to this foreign key,"], [3635.28, "Django will automatically set up the relationship"], [3638.01, "going in that opposite direction."], [3640.0, "And so here, well, if we have an airport,"], [3642.39, "and I want to know all of the flights that have that airport as their origin,"], [3645.75, "the reasonable name for a related name here is something like departures."], [3650.43, "So if I have an airport, I can access all"], [3653.04, "of the departures, which gets me all of the flights that"], [3655.95, "are leaving from that airport."], [3658.35, "And I\u0027ll likewise do the same thing here for destination."], [3660.96, "Instead of a character field it\u0027s going to be a foreign key."], [3664.08, "It\u0027s going to reference airport."], [3666.0, "When we delete it, we\u0027ll go ahead and cascade it."], [3668.31, "And the related name will be arrivals."], [3671.16, "Because if I have an airport, I might want"], [3673.05, "to access all of the arrivals, all of the flights"], [3675.81, "that correspond to flights that are arriving"], [3678.72, "at that particular destination."], [3681.395, "And so now, I\u0027ve done two things."], [3682.77, "I\u0027ve added a new class called airport, and I\u0027ve"], [3685.62, "modified my existing flight model."], [3688.38, "So this has changed in my Python code, but it hasn\u0027t yet"], [3691.11, "changed in my database."], [3692.89, "So in order to make the change in the database, again, it\u0027s a 2-step process."], [3696.67, "Step one, python manage.py, make migrations,"], [3700.5, "to say look for any new changes that have been made to models.py,"], [3705.37, "and go ahead and create a migration instruction"], [3708.33, "for how to make those changes to the database."], [3710.95, "And here, we see that we\u0027ve created a new migration file."], [3715.44, "And this migration is going to create a model called airport."], [3718.53, "And it\u0027s also going to alter the destination field"], [3721.38, "and alter the origin field on my flight model."], [3724.29, "Because as we know, we\u0027ve changed destination and origin"], [3727.35, "to no longer be character fields, but to instead"], [3729.78, "be references to a particular airport."], [3731.88, "So that\u0027s something that\u0027s going to need to change in the database."], [3735.03, "And to make that change, I can run something like python manage.py"], [3739.89, "migrate to go ahead and apply those changes."], [3742.47, "We\u0027ve now applied this migration that we just created,"], [3745.56, "and our database is now up to date."], [3748.95, "So what can we do?"], [3750.19, "Well, now I can go ahead and go back into the shell."], [3753.15, "And I\u0027ll just go ahead and import from flights.models import"], [3756.42, "star, import everything."], [3758.65, "And I can now create an airport."], [3760.32, "I can say something like JFK equals an airport whose code is JFK"], [3766.26, "and whose city is New York, for example."], [3769.44, "And then save that."], [3770.88, "I can create a London one."], [3772.05, "So LHR is an airport whose code is LHR and whose city is London."], [3777.65, "And I can save that."], [3779.063, "You could create more."], [3779.98, "I could say CDG equals an airport whose code is CDG and city is Paris."], [3786.27, "And maybe we\u0027ll do one more."], [3787.67, "We\u0027ll say NRT is the airport whose code is NRT and whose city is Tokyo,"], [3793.11, "for example."], [3794.2, "So I\u0027ve created and saved four airports that get added to my airport table."], [3798.48, "And now, I can add a flight."], [3800.73, "F equals flight whose origin equals JFK whose destination equals"], [3806.7, "London Heathrow and whose duration equals 415 minutes."], [3811.04, "And I\u0027ll go ahead and save that as well."], [3815.123, "So I\u0027ve now created four airports."], [3816.54, "I\u0027ve created a flight and saved it."], [3818.67, "If I type F just for my flight, I see that, all right,"], [3822.51, "this is a flight from New York to London."], [3825.24, "But I can also say what is f.origin, and to write f.origin,"], [3830.73, "that is now an airport object."], [3832.65, "It\u0027s JFK, in particular."], [3833.91, "And I can do f.origin.city to get the city of the origin, which is New York."], [3838.49, "f.origin.code to get the code of that airport, which is JFK."], [3842.82, "And if I start with an origin, something like JFK or London Heathrow,"], [3846.72, "I can say LHR.arrivals.all to get all of the arrivals, all"], [3853.2, "of the flights arriving in London Heathrow."], [3855.238, "And it looks like there\u0027s just one of them, which"], [3857.28, "is this flight that I\u0027ve just created from New York that"], [3860.43, "is going to London as well."], [3863.01, "And so this now gives us the ability to manipulate SQL"], [3866.31, "just by using these Python models."], [3868.13, "And I now have Python classes that represent"], [3870.72, "all of these various different types of data."], [3872.91, "And now, instead of running SQL queries like select star"], [3875.52, "from flights or from airports, I can just"], [3877.68, "interact with these classes and these properties on the classes,"], [3881.58, "and Django takes care of the process for me"], [3883.86, "of figuring out what the underlying SQL queries should be,"], [3886.89, "executing those queries, and just giving those results back to me."], [3890.67, "And we can begin now to design a web application around this idea."], [3894.57, "That I can go into urls.py, and lets add a url pattern that says,"], [3898.53, "the default route."], [3899.97, "We\u0027ll go ahead and load the index view."], [3902.16, "Give it a name of index."], [3903.36, "Same as similar things we\u0027ve seen from last time."], [3906.48, "And now, what should we do in the index view?"], [3909.54, "Well, the index view, let\u0027s go ahead and say, what I would like to do"], [3913.71, "is just display a list of all the flights."], [3916.65, "So I might from.models import flight and airport."], [3922.41, "Or maybe I just need flight."], [3923.707, "I just want a list of all the flights."], [3925.29, "So I\u0027m going to import flight from all of my models."], [3928.18, "And now, what I\u0027d like to do is return--"], [3930.54, "let\u0027s go ahead and render a template called flight/index.html,"], [3935.34, "and give index.html access to a variable called flights."], [3939.96, "And what is that variable going to be equal to?"], [3942.23, "It\u0027s going to be equal to flight.objects.all"], [3945.48, "to get me all of the flights that I would like to put right here."], [3950.37, "All right, so what can I do from now?"], [3952.03, "Now, what I need to do is actually create those individual templates."], [3955.41, "So inside of flights, I\u0027ll create a new folder called templates."], [3960.42, "Inside of which I\u0027ll create a new folder called flights."], [3963.3, "Inside of which I\u0027ll go ahead and create a layout.html,"], [3966.03, "much as we\u0027ve done before, where that layout"], [3968.25, "is going to contain the basic structure of our HTML page."], [3972.81, "So a head section whose title is flights, and a body section that"], [3978.91, "is going to have a block body, and the end of the block."], [3984.22, "Much as before, this is the default layout for this particular page."], [3988.42, "And then, I\u0027ll add a new template called index.html that is going to extend"], [3993.73, "flight/layout.html."], [3996.4, "And then, inside the body of the page, I\u0027m"], [4000.63, "going to display an H1 that just says flights."], [4003.84, "And let\u0027s now create an unordered list where I can now"], [4006.51, "loop over for flight in flights."], [4010.02, "endfor to end the loop."], [4011.55, "But inside the loop, let me create a list item"], [4014.2, "where I just print out a flight--"], [4017.64, "maybe I\u0027ll print out the flight and then flight.id"], [4021.54, "to print out flight 1, flight 2, flight 3."], [4023.94, "And then, I\u0027ll print flight.origin to flight.destination."], [4030.04, "So what I\u0027ve done here is create a template"], [4033.36, "that I\u0027m going to give access to a variable called flights, where flights"], [4036.93, "is going to be a variable that represents all of the flights"], [4040.32, "that I queried by running flight.objects.all, that is my way"], [4044.04, "using Django\u0027s API, using the functions that it has given me access to,"], [4047.52, "to say, take the flight and get all of the flights that are stored inside"], [4052.08, "of Django\u0027s database."], [4053.52, "Then here in the template, I\u0027m looping over each one of those flights."], [4056.82, "For each one, printing out a list item where"], [4059.73, "I can access properties of that flight."], [4061.6, "Say flight this ID from origin to a particular destination."], [4068.67, "So now, I\u0027ll go ahead and go into my terminal."], [4071.39, "Run python manage.py run server, which again,"], [4074.54, "is how we run a Django web application."], [4076.73, "And now, if I go to that URL, flash flights this time,"], [4079.94, "because that\u0027s the URL."], [4081.14, "What I see is exactly what I\u0027d expect to see."], [4083.33, "An unordered list that just so happens to have flight one New York to London"], [4088.91, "displayed there."], [4089.71, "It is taking data from my database, and now displaying it inside"], [4093.2, "of this template."], [4094.15, "And if I were to add new flights, it would also update on this page as well."], [4098.399, "So if I go ahead and go back, go into the shell, python manage.py shell."], [4102.62, "I\u0027ll go from flights.models import star."], [4106.189, "Let\u0027s go ahead and--"], [4108.529, "well, all right, let\u0027s add a flight from Shanghai to Paris, for example."], [4111.569, "Well, how do I get the airports for Shanghai and Paris?"], [4114.62, "Well, it turns out that if I want to get Shanghai,"], [4117.33, "I can say Shanghai equals airport.objects."], [4122.359, "and then I can say--"], [4123.56, "if I do airport.objects.all, that gets me all of the airports, for example."], [4128.819, "Oh, and it seems I don\u0027t actually have a Shanghai one,"], [4131.33, "but I can add one if I wanted to."], [4133.14, "But if I do airport.objects.all, that, again, gives me all of them."], [4137.13, "But if I want to filter my airports list, not get all of the airports"], [4140.3, "but just get some of them, I can say airport.objects.filter, and I can say,"], [4146.12, "get me all the airports where the city is New York, for example."], [4152.529, "And that is going to go ahead and give me a query set that only"], [4155.45, "contains the results that I care about."], [4157.52, "So again, airport.objects.filter lets me constrain the results that come back."], [4162.08, "Not get me all of the airports, but only get me"], [4164.54, "airports whose city is New York, for example."], [4167.24, "And it is only giving back one, so I could say .filter city equals New"], [4170.54, "York.first, to say, take that query set, and just get me the first and only"], [4175.069, "thing in that query set."], [4176.27, "And that gives me airport New York."], [4178.99, "A simplified way of doing the same thing."], [4180.71, "If you know you\u0027re only going to get one result back, is I"], [4183.56, "can say something like airport.objects.get,"], [4185.66, "which will only get one result if it knows that there\u0027s only going to be"], [4190.01, "one airport with the city of New York."], [4192.26, "That too will return to me New York JFK airport."], [4196.64, "But it will throw an error if ever there\u0027s more than one,"], [4199.02, "or if there\u0027s none, for example."], [4200.78, "So we\u0027ll go in and save that inside of JFK,"], [4202.85, "and we\u0027ll go ahead and create a flight that is going"], [4205.49, "from New York to Paris, for example."], [4207.88, "I can do CDG equals airport.objects.get."], [4211.576, "City equals Paris."], [4213.35, "And now, I have this variable CDG, which represents the airport Paris."], [4217.37, "And if I want to create a new flight that goes from New York to Paris,"], [4221.39, "I can say F is going to be a flight whose"], [4223.58, "origin is JFK whose destination equals CDG and whose duration equals 435."], [4230.38, "And I can save that flight as well."], [4233.1, "And so I\u0027ve added a new flight."], [4234.97, "And so now, if I run the server, python manage.py,"], [4238.7, "run server, refresh the page, I now see that I have two flights."], [4243.6, "One flight that\u0027s going from New York to London, one flight that\u0027s"], [4246.35, "going from New York to Paris."], [4248.33, "But of course, it\u0027s going to be pretty annoying if every time I"], [4251.09, "want to update the data, adding new data, manipulating the data,"], [4254.27, "I need to go into the shell in order to run"], [4256.82, "direct commands that are able to add new flights,"], [4258.95, "add new airport, so on and so forth."], [4260.81, "What I\u0027d really like to be able to do is just very simply"], [4263.81, "to add it via a web interface."], [4265.638, "Via the web, be able to say, all right, let"], [4267.43, "me add a new flight that goes from location 1 to location 2."], [4271.25, "And it\u0027s possible, using the information we know now,"], [4273.89, "to build a web page that does just this."], [4276.62, "But Django is built on this idea that it doesn\u0027t want you, the programmer,"], [4280.46, "to have to repeat work that other people have already done."], [4283.46, "And this process of trying to define models and very quickly be"], [4287.09, "able to create and edit and manipulate models"], [4289.16, "is so common that Django has already built for us an entire app that is just"], [4294.23, "designed for the manipulation of these models,"], [4296.96, "and it\u0027s known as the Django admin app."], [4300.02, "And this is an app that we\u0027ve seen traces of already,"], [4302.51, "that if we remember that urls.py file from inside of our application."], [4308.66, "We saw that we added a path for our own app,"], [4311.6, "but there was already a path given to us by default, /admin,"], [4315.56, "that takes us to the admin app as well."], [4318.93, "And so in order to use the admin app, we need"], [4321.47, "to create an administrative account inside of our Django web application."], [4325.76, "And the way to do that is via the command line."], [4328.1, "I can run python manage.py create super user."], [4332.875, "It\u0027s going to ask me for my name."], [4334.25, "I\u0027ll go in and type in my user name, my email address,"], [4338.02, "and it\u0027s also going to ask for a password."], [4339.77, "I can just make up a password that I would like to use."], [4342.56, "Retype it in just to confirm it."], [4344.42, "And now, Django has created a super user account for me in this web application"], [4350.03, "so that I, using these credentials, have the ability"], [4352.94, "to visit the web interface for the admin app"], [4355.4, "and actually manipulate some of these underlying models."], [4359.52, "So in order to do this, the first thing I need to do is take my models"], [4363.35, "and add those models to the admin app."], [4365.78, "So inside of models.py, I have a class called airport and a class"], [4369.5, "called flight."], [4371.01, "And if we look at the files I have, there\u0027s"], [4372.89, "another file we haven\u0027t really looked at yet called admin.py inside of my app."], [4377.66, "And inside of admin.py, I\u0027ll first from my models import flight and airport."], [4383.9, "And now, I\u0027m going to say, admin.site.register airport."], [4388.31, "And admin.site.register flight."], [4393.19, "And what this is going to do is it is going"], [4395.3, "to tell Django\u0027s admin app that I would like to use the admin"], [4398.87, "app to be able to manipulate airports and to be able to manipulate flights"], [4403.46, "as well."], [4405.24, "So let\u0027s take a look at this admin app and see how it actually works."], [4408.71, "I can run python manage.py run server."], [4413.06, "That will start up the web server."], [4414.98, "I\u0027ll now visit this URL."], [4416.21, "Instead of going to /flights I\u0027ll go /admin."], [4419.6, "And this opens up this Django administration app"], [4423.54, "that is not written by me."], [4424.67, "Django has written this, and it\u0027s asking me to log in."], [4427.49, "I\u0027ll go ahead and log in using those credentials I used a moment ago, typing"], [4430.85, "in my username and password."], [4432.44, "And what I get here is Django\u0027s site administration interface."], [4436.94, "Built for me by Django, where I didn\u0027t need to design this at all."], [4440.03, "But importantly, if we noticed down here,"], [4442.13, "I now have the ability to add and manipulate"], [4444.5, "airports and flights via this web interface, this Django"], [4448.01, "administrative interface."], [4449.16, "So now, using this interface, I have the ability"], [4451.7, "to manipulate the underlying database."], [4453.65, "To manipulate my models to add and modify data that already exists."], [4458.39, "So if I click on airports, for example, I see here,"], [4461.17, "here are all of the airports that I\u0027ve already added to my database."], [4464.15, "Tokyo, Paris, London, and New York."], [4466.37, "And I can add a new one."], [4467.45, "I can say, let\u0027s go ahead and add PVG which is Shanghai."], [4471.59, "And I can either save it, save and continue editing, save and add another."], [4474.91, "I\u0027m going to add a couple, so I\u0027ll go ahead and save and add another."], [4477.785, "Let\u0027s go ahead and add Istanbul airport as well."], [4480.71, "Let\u0027s add Moscow as an airport two, and maybe one more, we\u0027ll add Lima as well."], [4487.55, "And I\u0027ll just go ahead and click save."], [4489.17, "And now, I\u0027ve added a whole bunch of airports all via this web interface."], [4492.77, "Django was originally created for news organization that"], [4495.79, "very quickly wanted to be able to post articles and post"], [4498.44, "new posts on their website."], [4499.85, "And it made it very easy via an interface like this"], [4502.28, "to very quickly just say, here, add a new article"], [4504.8, "and here\u0027s the content of the article, to be able to display on a page."], [4508.07, "And now, we\u0027ve been able to very quickly add new airports to our website"], [4511.88, "as well."], [4512.91, "And so if we want to add flights, well, we can go ahead and go back home."], [4518.0, "Click on flights."], [4519.38, "I see that I already have two flights inside of my database."], [4521.96, "I have New York to London and New York to Paris."], [4524.42, "I\u0027ll add a new one."], [4525.8, "It\u0027s letting me choose an origin, destination, and duration."], [4528.68, "And Django knows that the origin must be an airport,"], [4531.35, "so it\u0027s going to give me the opportunity to just choose an airport."], [4534.4, "Where I can say, OK, Shanghai is the origin."], [4536.63, "The destination is going to be Paris, and the duration"], [4539.3, "is going to be 760 minutes, for example."], [4542.41, "So now, using Django\u0027s admin interface, I\u0027ve"], [4544.68, "been able to add a number of different flights"], [4546.78, "and a number of different airports."], [4548.43, "And if I go back, not to the admin app, but to my flights app,"], [4552.21, "the app that I wrote myself, and go back to /flights."], [4554.97, "Now, I actually see all of the new flights"], [4557.79, "that I have added to my database via Django\u0027s admin interface."], [4561.253, "I added them to the admin interface, and now I see this flight from Shanghai"], [4564.42, "to Paris."], [4565.2, "I see this flight from Paris to New York as well."], [4569.77, "And so now, what I might like to do is begin"], [4571.83, "to add some more pages to this web application."], [4574.28, "Make this web application a little more sophisticated"], [4577.14, "by maybe giving me the ability to click on a particular flight"], [4580.86, "to view details about that flight."], [4582.84, "What I\u0027d like is for every flight to have its own page,"], [4585.66, "not just /flights for all the flights, but /flight/one for flight ID one."], [4590.52, "/flight/two for ID two, so on and so forth."], [4594.24, "What I can do in order to do that is go back into urls.py"], [4598.65, "and create a new path."], [4600.09, "We\u0027ll create a path where I\u0027m going to specify"], [4602.76, "a flight ID, which would be an integer."], [4605.49, "When I do, let\u0027s go ahead and load the flight view, whose name will be flight."], [4609.81, "And now, I need to just go to views.py and add a function called flight."], [4614.73, "So I go back, go into views.py."], [4617.07, "In addition to an index function, we\u0027ll define a flight function that"], [4621.21, "accepts as an argument a flight ID."], [4624.39, "So now, what is the flight function going to do?"], [4626.74, "Well, the first thing I need to do is actually get that flight."], [4629.82, "I can say flight equals flight.objects.get."], [4632.63, "Get me the flight whose idea is equal to flight ID, for example."], [4638.97, "Or alternatively, Django also let\u0027s you say pk instead of ID."], [4642.69, "It\u0027s a much more generic way of referencing"], [4644.49, "the primary key, for whatever the primary key happens to be called."], [4647.85, "The pk in this case is just the ID."], [4650.16, "But then what I can do is render a template, like flight/flight.html,"], [4656.79, "and pass as input to that the flight."], [4660.42, "So we\u0027re passing this flight to flight.html."], [4664.29, "And now, I can create a template--"], [4666.3, "create a new file called flight.html which is going to also extend"], [4672.03, "flight/layout.html using that same HTML layout."], [4676.09, "And inside the body of the page, let\u0027s just"], [4679.32, "say something like in big we\u0027ll say flight ID."], [4684.87, "And then, maybe an unordered list where I can say something like the origin"], [4688.92, "is flight.origin."], [4691.35, "The destination is flight.destination."], [4695.81, "And the duration is flight.duration."], [4701.69, "So now, I have a page that displays flight information"], [4704.57, "about any particular flight."], [4706.43, "And if I go ahead and load not /flights in my web browser, but /flights/one,"], [4711.53, "for example."], [4712.222, "Well, now I have information about flight number one."], [4714.43, "And /flight/two gets me information about flight number two."], [4718.04, "Querying for that particular flight, then printing out"], [4720.44, "its origin, destination, and duration."], [4723.48, "Now, there is some error checking that we probably should do here."], [4726.23, "If I try and access a flight that doesn\u0027t exist,"], [4728.23, "something like flight 28, for example."], [4730.77, "I\u0027m going to get some sort of error that does not exist error."], [4733.55, "Flight matching query does not exist."], [4735.59, "I might like to control what happens in that situation a little better."], [4738.873, "So you might imagine adding some additional error checking"], [4741.29, "to handle those cases as well."], [4742.79, "But we\u0027ll leave it at this just for now."], [4745.31, "But now, let\u0027s go ahead and add the ability,"], [4747.8, "not only to have flights that have airports associated with them,"], [4751.04, "but let\u0027s also add passengers to our flights"], [4753.65, "as well to be able to represent passengers that might actually"], [4756.8, "be on these flights, too."], [4758.86, "So go ahead and go back into models.py."], [4762.69, "And in models.py, in addition to an airport class and a flight class,"], [4767.12, "let me create a new class called passenger."], [4771.35, "Also going to be a model."], [4772.97, "And what properties does a passenger have?"], [4775.19, "Well, a passenger has a first name, which"], [4777.11, "we\u0027ll go ahead and make a models.CharField whose max length"], [4782.45, "we\u0027ll put at 64."], [4784.61, "And the last name."], [4787.43, "Max length equals 64."], [4789.38, "And passengers also, as we described before,"], [4792.29, "they have a many to many relationship with flights."], [4795.725, "That a flight could have multiple passengers,"], [4797.6, "a passenger could be on multiple flights,"], [4799.58, "and ultimately, we need an additional table to keep track of this."], [4802.49, "But we can think a little bit more abstractly here in Django"], [4805.31, "and just say that every passenger has flights associated with them, which are"], [4809.93, "a models.manytomanyfield with flight."], [4814.58, "So every passenger could be associated with many flights."], [4818.22, "We\u0027ll say blank equals true to allow the possibility that a passenger has"], [4822.29, "no flights."], [4822.89, "Maybe if they\u0027re not registered for any flights at all."], [4826.14, "And we\u0027ll also give this a related name of passengers,"], [4830.15, "meaning if I have a passenger, I can use the flights attribute"], [4833.96, "to access all of their flights."], [4835.64, "And likewise, if I have a flight, I can use this passenger\u0027s related name"], [4839.87, "to access all of the passengers who are on that flight."], [4842.93, "And we\u0027ll see how that\u0027ll be useful in a moment, too."], [4845.66, "The string representation of a passenger will just"], [4848.75, "go ahead and be their first name space their last name,"], [4852.8, "which feels like a reasonable way of representing a particular passenger."], [4856.61, "And now, I need to apply these changes."], [4858.92, "I need to say, python manage.py."], [4861.08, "Make migrations because I\u0027ve made new changes to my model."], [4864.44, "I\u0027ve created a model passenger, in particular."], [4867.14, "And now, if I do python manage.py migrate,"], [4870.05, "now I\u0027ve applied those changes to my actual database."], [4873.8, "And if I go into admin.py, so we\u0027ll go into admin.py,"], [4878.66, "and register not only flight and airport but passenger,"], [4883.46, "admin.site.register passenger, then now via the admin interface,"], [4888.02, "I can manipulate passengers as well."], [4890.27, "I can say python manage.py run server to run my web server."], [4895.55, "Go to my web servers admin view by going to /admin."], [4899.81, "Go down to passengers, and let\u0027s go ahead and add a passenger."], [4904.24, "Where I can say, all right, first name Harry,"], [4906.32, "last name Potter, and we\u0027ll go ahead and put him on flight 1 and flight 3,"], [4911.43, "maybe."], [4911.93, "He\u0027s on two different flights, for example."], [4913.81, "And you can hold down command or control to be able to select multiple flights."], [4917.36, "And we\u0027ll go ahead and save that."], [4918.86, "Harry Potter has been added successfully."], [4920.72, "And let\u0027s add a couple of other passengers."], [4922.512, "We\u0027ll add Ron Weasley."], [4924.53, "And we\u0027ll add another."], [4925.61, "We\u0027ll add Hermione Granger."], [4928.31, "And we\u0027ll add Ginny Weasley as well."], [4931.48, "So we\u0027ve added a number of different passengers"], [4933.44, "that now all exist in Django\u0027s admin interface."], [4936.38, "And now, what I\u0027d like to do is on the flight page,"], [4938.9, "display information about which passengers"], [4941.42, "happened to be on any given flight."], [4943.79, "So the way I might do that is by going into views.py."], [4949.25, "And on the flight page, in addition to giving access to the flight,"], [4953.24, "let me also give it access to passengers."], [4955.73, "So passengers this template is going to get access to."], [4959.01, "And we get passengers by saying flight.passengers.all."], [4963.67, "And the reason we can do this is, again, because passengers"], [4966.74, "is that related name."], [4968.03, "It is our way of taking a flight and getting all of the passengers that"], [4972.05, "happened to be on that flight."], [4974.75, "And so now, inside of flight.html I can add something like,"], [4981.23, "let\u0027s add an H2 called passengers."], [4984.16, "Where here, I\u0027m going to loop for passenger in passengers."], [4990.57, "Go ahead and display that passenger."], [4994.92, "Just print out that passenger inside of a list item."], [4998.05, "And in Django, I can say, if the list is empty,"], [5000.47, "let\u0027s just have a list item that says, no passengers."], [5003.47, "Meaning nobody is currently on this flight."], [5007.37, "So now, my web server is still running."], [5009.62, "I can go back to /flights."], [5011.7, "Here are all of the flights."], [5014.05, "And if I go to /flight/one I now see that I\u0027m flight one."], [5017.81, "Harry Potter is a passenger on that flight."], [5020.16, "But if I go to flight two, all right, no passengers are on that flight either."], [5024.173, "And now, it\u0027s been a little annoying that I\u0027ve"], [5026.09, "had to do everything by using the URL here to be able to go"], [5029.36, "back and forth between pages."], [5031.01, "I could link to those pages if I want to."], [5033.56, "And the way I might do that is, let\u0027s on the flight page,"], [5037.04, "add a link that goes to the URL index that says something"], [5043.25, "like, back to flight list, maybe."], [5046.25, "So here is now a link that takes me to the index view."], [5049.4, "And likewise, I can go into index.html."], [5052.76, "And for each of these list items, each of these list items"], [5056.27, "is really going to be a link that links to it\u0027s a url to a particular flight."], [5063.77, "And the flight route takes as a parameter a flight ID."], [5067.64, "And so inside this url a substitution here."], [5070.52, "I can specify use flight.id as the ID of the flight"], [5075.26, "that I would like to use here."], [5077.85, "And so now, I\u0027ve put every single flight inside"], [5080.75, "of a link that takes me to the flight route."], [5083.45, "But because the flight route requires as an argument the flight ID,"], [5086.72, "I can specify the flight ID here."], [5090.25, "And so now, if I go back to /flights, I now see a list of flights where every"], [5094.4, "flight is in fact a link that can take me somewhere else."], [5097.77, "And so now, I can click on any one of those links, like New York to Paris,"], [5102.02, "and that takes me to the flight page."], [5103.73, "I can click back to flight lists, that takes me back to the flight list."], [5106.73, "Click on another flight and go to that flight as well."], [5109.32, "So I\u0027ve now been able to come up with this way of linking"], [5112.82, "these pages together by having links in each of the various different pages"], [5116.39, "that take me to some other route as well."], [5120.69, "And so now what I might like to do is, in addition"], [5122.78, "to displaying all the passengers on any particular flight,"], [5125.51, "also give myself the ability to add passengers to a flight"], [5128.75, "as well, which feels like a reasonable thing"], [5130.76, "that I might want to do inside of this web application."], [5133.83, "And so how can I go about doing that?"], [5135.947, "Well, in order to do that, I\u0027m going to need"], [5137.78, "some new route that lets me book a flight for a particular passenger."], [5142.33, "And so I\u0027ll go ahead and go back to urls.py."], [5145.61, "And inside of urls.py I\u0027ll add a new path that will be int flightid/book."], [5154.43, "And int flightid/book is going to let me book"], [5156.68, "a flight for this particular flight ID."], [5159.68, "For flight one or flight two or flight three, or so forth."], [5163.49, "When I do, we\u0027ll go ahead and go to the book view, and we\u0027ll name that book."], [5168.56, "And so now, I need to implement the book view."], [5172.233, "So how is this view going to work?"], [5173.65, "I\u0027m going to define a function called book"], [5177.29, "that is going to take as its argument, not only the request,"], [5181.07, "but also a flight ID."], [5182.96, "The first thing, as with before, is I want to get the flight ID."], [5186.11, "But remember from before, that there are multiple ways"], [5188.54, "that I can request a web page."], [5190.61, "I can request a web page via the get request method,"], [5193.47, "which means I would just like to get this page."], [5195.95, "Or I can request the method via post, meaning"], [5198.14, "I would like to send data to the page."], [5200.33, "And generally speaking, anytime you want to manipulate the state of something,"], [5204.57, "especially manipulating our database, that"], [5206.69, "should be inside of a post request."], [5209.0, "I\u0027m submitting some form, some data."], [5211.16, "And in response to that post submission, you"], [5213.41, "should manipulate what\u0027s going on inside of the database."], [5217.1, "So we\u0027re going to check when this book route is called upon."], [5221.0, "If request method is post, then we want to perform some sort of action."], [5226.31, "The flight in question is just going to be flight.objects.get."], [5231.17, "Get the flight whose primary key is that flight ID."], [5235.46, "And then, what I\u0027d also like to do is associated with the form."], [5238.94, "When someone submits this form to book a new passenger on the flight,"], [5242.12, "they should tell me what the ID is of the passenger."], [5245.78, "What passenger should I book on the flight?"], [5247.752, "Because those are the two pieces of information"], [5249.71, "you need to know in order to actually book a flight."], [5251.99, "You need the flight and the passenger information."], [5255.03, "So let\u0027s assume for now that the information is"], [5257.51, "going to be in request.post and then in square brackets passenger."], [5262.88, "What this means is that the data about which passenger"], [5265.94, "ID we want to register on this flight is going"], [5269.57, "to be passed in via a form with an input field whose name is passenger."], [5274.16, "The name on any particular input field dictates what name we get--"], [5278.4, "is received when a route like this book route"], [5281.06, "is able to process the request from the user."], [5284.22, "So we\u0027ll go ahead and take that information."], [5286.12, "And because by default this might be a string, let\u0027s go ahead"], [5289.55, "and convert it into an integer just to make sure"], [5291.95, "we\u0027re dealing with an integer."], [5293.6, "And let me say that the passenger in question"], [5296.21, "is going to be passenger.objects.get pk equals this whole thing."], [5304.1, "So now what I\u0027ve done is, if the request method"], [5306.83, "is post, meaning someone submitted this form via the post request method,"], [5310.88, "I\u0027m first thing flights.objects.get. to get a particular flight,"], [5314.69, "get me the flight with that flight ID."], [5317.24, "And then, I\u0027m getting a passenger."], [5319.01, "Which passenger am I getting?"], [5320.51, "The one who\u0027s pk, their primary key, otherwise known as ID,"], [5323.87, "is equal to whatever was submitted via this post form"], [5327.83, "with a name of passenger."], [5329.72, "And we haven\u0027t yet created that form, but we\u0027ll do so in just a moment."], [5333.69, "Now ultimately, we\u0027ll want to add some more error checking to this as well,"], [5336.98, "like what if someone requests a passenger that doesn\u0027t exist,"], [5339.8, "or a flight that doesn\u0027t exist either."], [5341.5, "So there is definitely some error checking"], [5343.25, "that we probably should be doing here."], [5345.03, "But for simplicity, let\u0027s just assume for now that we\u0027re able to get a flight"], [5349.04, "and get a passenger."], [5350.66, "Well, how do we access a passenger\u0027s flights?"], [5353.09, "I can just say passenger.flights."], [5356.54, "And in order to add a new item to some set like flights,"], [5360.14, "I can just say passenger.flights.add flight."], [5364.132, "And this will do the equivalent of adding"], [5365.84, "a new row into a table of keeping track that the passengers on that flight."], [5369.74, "But the nice thing about Django\u0027s abstractions"], [5371.93, "is that I don\u0027t have to worry about those underlying details."], [5374.6, "I don\u0027t have to worry about what the structures of the tables are."], [5377.42, "I can think at a much higher level and just say take this passenger,"], [5381.86, "take their set of flights, and go ahead and add a new flight"], [5385.28, "to that set of flights."], [5387.82, "And when all that\u0027s said and done, what I probably want to do"], [5391.25, "is return some sort of redirect that redirects the user back"], [5395.42, "to the flight page."], [5396.56, "So we\u0027ll go ahead and return an HTTP response redirect."], [5401.21, "What you URL would I like to take them to?"], [5403.17, "Well, I\u0027d like to take them to the flight route."], [5406.7, "And reverse, again, takes the name of a particular view,"], [5409.88, "and gets me what the URL is, and we saw that last time."], [5413.18, "And the flight route takes an argument."], [5414.93, "So I need to pass as an argument the flight\u0027s ID."], [5418.618, "So I need to provide it to the flight route"], [5420.41, "what the flight\u0027s ID is, structured it as a tuple,"], [5423.62, "and that is going to redirect me back to the flight route"], [5427.22, "so that I can see that flight page again."], [5430.79, "And what I need to add up at the top here is from django.http."], [5435.74, "Import HttpResponseRedirect in addition to from django.urls import reverse."], [5447.37, "And so those I\u0027ll need to add as well so that I"], [5449.55, "can redirect the user back to the flight page"], [5452.22, "after they\u0027re done submitting the form."], [5453.9, "And reverse takes the name of a particular view,"], [5457.11, "as defined in urls.py, something like index or flight or book,"], [5461.22, "and gets me what the actual URL path should be."], [5464.32, "And as we talked about last time, that\u0027s helpful"], [5466.32, "so that I don\u0027t have to hard code URLs into my Django web application."], [5470.34, "I can just reference URLs by their name."], [5472.62, "And if ever I need to change a URL, I can just"], [5474.87, "change it in one place in urls.py, and that change"], [5478.59, "is going to reflect everywhere else as well."], [5482.49, "So now, the next thing I need to do is actually create this form."], [5486.38, "That what I have so far is just a function"], [5488.61, "called book that is waiting for a post request to be made to it."], [5492.24, "And when a post request is made to it, then we\u0027re"], [5494.46, "going to go ahead and submit this form and go ahead and add the flight"], [5497.85, "for this particular passenger."], [5499.53, "But what I\u0027d like to do now is actually add that form."], [5502.36, "So I\u0027ll go back into templates, go into flight.html,"], [5506.68, "and what I\u0027d like to add here is a form."], [5509.25, "I\u0027ll go ahead and label it with an H2 called add passenger."], [5513.18, "And we\u0027ll create a form whose action is going to be URL of book."], [5520.22, "So we\u0027re going to go to the book route."], [5521.94, "And again, if we recall the book route in urls.py,"], [5524.71, "the route with name book, this view, requires as a parameter some flight ID."], [5530.25, "So I need to provide the flight ID as an argument for what flight"], [5534.06, "I\u0027m booking the passenger on."], [5535.92, "And it just so happens to be flight.id because this template has"], [5538.89, "access to a variable called flight."], [5541.73, "The method of this submission is, again, going to be post."], [5545.4, "And recall from before that whenever I have a form in Django,"], [5548.16, "I need to give it the CSRF token just for security to make sure"], [5551.61, "that Django knows it\u0027s really this application that"], [5554.16, "is submitting this form."], [5555.72, "We\u0027ll go ahead and add a dropdown list, which you can"], [5558.21, "create in HTML using a select field."], [5561.27, "The name of this select field is going to be passenger."], [5565.41, "And the reason for that is inside of views.py, when I get the passenger,"], [5569.97, "I\u0027m looking for inside the post data, inside of request.post,"], [5573.57, "for a field whose name is passenger."], [5575.88, "And so that is what I would like the name of this dropdown to be."], [5579.65, "And inside of a select dropdown, we have a whole bunch of options."], [5583.11, "Options that we can choose from."], [5584.68, "And there\u0027s going to be one option for everyone who"], [5587.4, "isn\u0027t a passenger on this flight."], [5590.7, "And so how do I get everyone who isn\u0027t a passenger on the flight?"], [5593.85, "Well, it seems that right now, the flight page only has access"], [5597.15, "to actual passengers, and doesn\u0027t yet have access to people"], [5601.02, "that are not passengers on the flight."], [5603.42, "So it sounds like I need to add some additional context to this template."], [5606.99, "Additional information that we want access to."], [5609.87, "So I\u0027ll go ahead and give this flight access to additional information"], [5613.26, "that we\u0027ll call non-passengers."], [5615.54, "For people that are not on the flight."], [5618.0, "And how do we I non-passengers?"], [5619.92, "Well, just as I could say passenger.objects.filter"], [5623.64, "to only get passengers that match a particular query,"], [5627.25, "there\u0027s also a way in Django to say passenger.objects.exclude to say"], [5631.98, "exclude passengers that satisfy a particular query."], [5635.8, "So I want to exclude passengers who, among their flights,"], [5639.45, "have this as one of their flights."], [5642.6, "And so what does this actually mean?"], [5644.29, "Well, it means that when I render flight.html,"], [5646.92, "there\u0027s a couple pieces of information that it should have."], [5649.53, "It needs to know what flight is being rendered."], [5651.87, "It needs to know who is on the flight, who are the passengers."], [5655.0, "But if I want a dropdown where I can choose from all the people"], [5657.69, "who aren\u0027t already on the flight, like I would"], [5659.82, "like to register you for the flight, well, I also"], [5662.31, "need all of the non-passengers."], [5663.84, "Passengers except, excluding the ones who are already on the flight,"], [5669.36, "and get me all of them is what that .all is ultimately saying."], [5673.56, "And so using that, I now have access to this variable"], [5676.83, "called non-passengers that I can use as I\u0027m constructing this page."], [5681.9, "So back on flight.html, I can say, for every passenger in non-passengers,"], [5689.64, "let me create a option that I can choose from."], [5694.24, "And the options value is going to be the passenger\u0027s ID."], [5699.26, "Because ultimately, when I submit the form, what I care about getting"], [5702.68, "is what is the ID of this passenger that I\u0027ve chosen from this dropdown."], [5706.825, "But of course, the user who\u0027s looking at this page,"], [5708.95, "they don\u0027t want to see people\u0027s IDs."], [5710.54, "They want to see people\u0027s names."], [5712.28, "So inside of the option tag, we\u0027ll go ahead"], [5714.98, "and just print out the passenger\u0027s name."], [5717.64, "And we\u0027ll see in a moment what all of this"], [5719.39, "actually looks like in terms of HTML."], [5721.86, "So now that I\u0027ve created this form, I\u0027ll also"], [5724.4, "need at the bottom to add an input whose type is submit"], [5727.52, "to let myself submit this form to."], [5730.46, "Let\u0027s now try running this application."], [5733.09, "It looks like there\u0027s a slight error where"], [5734.84, "I said view.book instead of views.book."], [5736.903, "Views is the name of the module, since it\u0027s in a file called views.py."], [5739.82, "And now, it looks like my server is running OK."], [5743.36, "I can go back to /flights."], [5745.43, "Let me get one of the flights, like New York to London, flight number one."], [5748.96, "And all right."], [5749.6, "Name error."], [5750.59, "Name passenger is not defined."], [5752.15, "This is how Django renders to me errors that are occurring in my Python code."], [5755.78, "Looks like it just means inside of veiws.py I\u0027m referencing passenger,"], [5760.43, "but I never imported it."], [5761.45, "So up at the top, I\u0027ll go ahead and import passenger as well."], [5765.45, "Now, it seems that my web application is working OK."], [5767.75, "So now, hopefully, I refresh this page, I see flight information."], [5771.84, "I see passengers."], [5772.96, "And I also down at the bottom now see an add passenger section"], [5776.75, "with a dropdown list."], [5777.9, "Where I can click on it and see, all right, here"], [5779.9, "are the three people that are not already on this flight."], [5783.35, "And so if I want to add Ginny Weasley to this flight,"], [5786.62, "I can click Ginny Weasley, click submit, and that submits the form."], [5790.46, "And I\u0027m redirected back to the same flight page."], [5792.95, "Now, Harry and Ginny are both on the flight."], [5795.11, "And in the add passenger list, I see Ron and Hermione as the options for me"], [5800.44, "there."], [5801.78, "And so using Django\u0027s models, I\u0027ve been able to very quickly build up"], [5804.86, "a reasonably sophisticated application."], [5806.75, "An application that has models, that displays that information to me,"], [5810.41, "and lets me manipulate that data."], [5812.03, "And that data is ultimately stored inside of a SQL database."], [5816.24, "And one of the big powers of Django that it really gives to me"], [5819.11, "is this admin interface that I ordinarily"], [5822.14, "might have had to spend a lot of time designing a web interface that just"], [5825.53, "lets me do things like take some person and go ahead and update"], [5829.64, "what is their name, what flights are they on,"], [5831.68, "and the ability to very quickly add and delete and edit the models"], [5835.56, "is something that in a web application could take quite a lot of time"], [5838.88, "to be able to build from scratch."], [5840.44, "But Django, very fortunately, gives all of that right to me."], [5844.28, "And this admin interface, even though it is designed by Django,"], [5847.31, "it\u0027s very customizable in terms of things"], [5849.17, "that I can do on this admin interface if I want to manipulate it in certain ways"], [5853.64, "in order to add additional features to it as well."], [5856.86, "So we\u0027ll see a couple of brief examples of this."], [5859.07, "If I go into admin.py, here\u0027s my configuration"], [5863.03, "for Django\u0027s admin interface."], [5865.0, "And I can say, I would like to configure the admin"], [5867.92, "interface in a particular way."], [5869.75, "That in a flight, for example, by default all I saw"], [5872.81, "was the flight\u0027s origin and destination."], [5875.03, "If I want to be able to see more information about a flight,"], [5877.61, "I can say, go ahead and give me a class called flight admin, which is"], [5881.87, "going to be a subclass of model admin."], [5885.41, "Where I can specify any particular settings"], [5888.17, "that I want to apply to how the flight admin page is displayed."], [5892.47, "So I can-- and all of this is documented on Django\u0027s website."], [5895.03, "And you just have to read it to be able to know what configuration options are"], [5898.28, "available to you."], [5899.46, "But I can say, in the list display, when you list all the flights"], [5902.66, "and display them all to me, what field should I have access to?"], [5906.05, "Well, go ahead and show me something like the origin"], [5909.5, "and the destination and the duration and maybe also show me the ID, for example."], [5915.53, "So I want to see all of this information when you load a flight."], [5918.95, "And when I register the flight, I\u0027ll say register this flight,"], [5922.04, "but use the flight admin settings when you do so."], [5924.97, "So I can specify, I would like to use these particular settings"], [5928.58, "when you view the admin interface."], [5931.43, "And so now, if I go back and go ahead and click on flights,"], [5935.21, "then now in this list display, whereas before I only"], [5938.24, "saw IDs and origins and destinations, now I"], [5940.76, "can configure it to show me all of the IDs and origins and destinations"], [5944.51, "and durations as well."], [5945.89, "I\u0027ve been able to configure this display to work the way I would like it to."], [5949.85, "And there are other configurations you can do as well."], [5952.25, "One that I quite like to use is if I want to update my passenger admin,"], [5956.09, "so when I\u0027m editing a passenger, you can have"], [5959.21, "a special way of manipulating many to many relationships inside"], [5962.78, "of an attribute called filter horizontal."], [5965.63, "And if I use a horizontal filter on flights,"], [5969.11, "this will just make it a little bit nicer for manipulating"], [5971.9, "the flights that a passenger is on."], [5973.52, "And again, the specific syntax of this not as important as the idea"], [5976.58, "that these are all just configurable settings that Django has documented."], [5979.85, "That you can look at to see how to configure the Admin interface to work"], [5982.85, "exactly the way you want it to work."], [5985.7, "And so now, if I go back home and go to passengers,"], [5988.69, "and maybe click on a passenger like Harry Potter,"], [5991.27, "I now see this horizontal filter, which is"], [5993.55, "a very nice way of being able to manipulate flights"], [5996.37, "that the person is on."], [5997.54, "I see on the left a list of their available flights"], [5999.7, "that I could add them to."], [6001.17, "On the right, a list of their chosen flights."], [6003.15, "Flights that they\u0027re already on."], [6004.68, "And it becomes very easy for me to just take a flight and double click on it"], [6008.43, "to move it from an available flight to a flight that they\u0027re on and vise versa."], [6012.48, "Just very quickly being able to control and manipulate these models."], [6016.05, "And this is all stuff that Django just gives to you right out of the box."], [6020.94, "So Django now has given us a lot of features."], [6023.26, "The ability to represent models very succinctly."], [6025.86, "A migration method for being able to very quickly apply"], [6028.5, "those changes to our database."], [6030.42, "And the last thing we\u0027ll take a look at is this idea of authentication."], [6034.088, "That on many websites, we want some method of authentication."], [6036.63, "Some ability for users to be able to log in and log out."], [6039.78, "For Django to remember who a particular user happens to be."], [6043.35, "And what we\u0027re going to do now is introduce"], [6045.18, "an application that lets us interact with this authentication method."], [6048.88, "Because Django has a whole bunch of authentication features"], [6051.66, "built right into the framework that we can take advantage of so"], [6054.53, "that we don\u0027t need to rewrite all the logic for how do you log someone in,"], [6058.08, "and what does it mean to represent the user."], [6059.97, "Django has done a whole lot of that for us."], [6062.67, "So we\u0027ll go ahead and create an application to do that now."], [6065.77, "All right, so let\u0027s go back into my terminal now."], [6067.95, "And now, I have this airline project inside"], [6069.96, "of which is one app called flights."], [6071.82, "And I\u0027d like to now create another app that\u0027s going to maintain users inside"], [6075.0, "of this application."], [6076.3, "So I\u0027ll go ahead and run python manage.py start app users."], [6080.19, "Which will just be an app that\u0027s going to allow me to represent users."], [6083.82, "As before, when I create a new application,"], [6087.83, "I\u0027ll need to go into settings.py."], [6089.91, "Add users as one of the installed apps inside of this project."], [6095.37, "And I\u0027ll go into urls.py to say I\u0027d also like when I go to users,"], [6101.81, "we\u0027ll go ahead and include users.urls."], [6105.81, "So all the URLs that are associated with my user\u0027s application."], [6109.56, "Now, I\u0027ll need to actually create those URLs."], [6112.07, "So I\u0027ll go ahead and go down into my users application,"], [6115.12, "create a new file called urls.py, inside of which"], [6118.86, "is the same as what we\u0027ve normally see inside of these URLs files."], [6122.01, "I need to import path, import my views, and then define some URL patterns."], [6128.75, "Where here what I\u0027d like to do is define one path that takes me to views.index."], [6136.15, "And we\u0027ll call this one index."], [6138.16, "Then I\u0027ll create another path that takes me to log in, called the log in view."], [6144.17, "And the name will be log in."], [6146.53, "And we\u0027ll have another path called log out for a function called log out"], [6151.38, "view that will be associated with it."], [6153.638, "So we\u0027ll effectively have three different routes."], [6155.68, "One main index route that\u0027s just going to display information about the"], [6158.77, "currently signed in user."], [6160.37, "One route for logging someone in, a form that"], [6162.31, "will display the place where they can type in a user name"], [6164.71, "and password to log in."], [6165.97, "And then, one route to allow users to be able to log out from this application"], [6170.05, "as well."], [6171.335, "So let\u0027s go ahead now and actually write these functions."], [6173.71, "We need one function called index, one function"], [6175.78, "called log in view, one function called log out view."], [6179.35, "So we\u0027ll go into views.py, and we\u0027ll start with index."], [6183.57, "And so what does the index function need to do?"], [6185.53, "It\u0027s going to display information about the currently signed in user."], [6189.37, "That I sign into this website, and then I\u0027m presented with the index page."], [6193.2, "Because if we think about this programmatically,"], [6195.34, "we first need to think about what should happen"], [6197.74, "if someone tries to access this page but they\u0027re not authenticated."], [6201.64, "How would we even find that out, and what do we do in that situation?"], [6204.74, "Well, let\u0027s say, if not request.user.is_authenticated."], [6210.99, "The request object that gets passed in as part of the request"], [6213.83, "to every user in Django automatically has"], [6216.1, "a user attribute associated with it."], [6218.32, "And that user object has an is authenticated attribute that tells us"], [6222.4, "if the user is signed in or not."], [6224.8, "If they\u0027re not signed in, we\u0027ll go ahead and HTTP response"], [6228.7, "redirect them to the log in view."], [6233.142, "And in order to make this work, I\u0027m going"], [6234.85, "to need to-- from django.http import HttpResponseRedirect."], [6240.31, "And likewise, from django.urls, let\u0027s go ahead and import reverse as well."], [6246.47, "So if the user is not authenticated, then"], [6248.92, "we\u0027re going to redirect them to the log in view, where what is the log in view"], [6252.55, "going to do?"], [6253.97, "Well, the log in view for now, let\u0027s just go ahead and render"], [6258.94, "users/login.html."], [6261.67, "Some form where the user can log themselves in."], [6264.78, "We\u0027ll need to create some templates."], [6266.35, "I\u0027ll create a templates folder inside of which is a user\u0027s folder."], [6270.49, "Inside of which we\u0027ll just create a basic layout,"], [6272.89, "as we\u0027ve done multiple times now."], [6276.2, "This is, again, going to be the general structure for pages in this app."], [6280.01, "Title will be users, and the body will just"], [6282.8, "have a block called body that I can later fill in with other content."], [6288.41, "And now that I have this HTML layout, I can go ahead and create a new file"], [6292.34, "called login.html, where login.html will extend user/layout.html."], [6300.07, "And inside the body block, I can just display in HTML form."], [6306.622, "So I can say something like, I would like"], [6308.33, "for there to be a form, whose action, when I submit the forum--"], [6311.87, "let\u0027s go ahead and still go to the log in URL,"], [6314.87, "but let\u0027s do so using the post request method."], [6317.96, "Again, I\u0027m logging in, I\u0027m submitting a form."], [6320.12, "Generally, when you\u0027re doing that, you want"], [6321.912, "to submit form data via post, especially in the case of user name and password."], [6325.37, "Because if you do this sort of thing, you"], [6327.212, "don\u0027t want the user name and password to be passed in as get parameters"], [6330.17, "because those show up in the URL."], [6332.6, "Our form will have our CSRF token for security as before."], [6336.53, "And input whose type is text, whose name is username, and just"], [6341.09, "for user friendliness, let\u0027s give it a placeholder also of user name"], [6344.24, "so the user knows to type in their user name here."], [6347.36, "We\u0027ll also have an input whose type is password, whose name is also password,"], [6352.47, "and when an input\u0027s type is password, that just"], [6354.62, "means our HTML will know in the browser that chrome or Safari or whatnot"], [6358.19, "will know to show the password as dots instead of as characters."], [6362.21, "And we\u0027ll give that a placeholder of password."], [6365.69, "And then an input of type submit whose value is log in."], [6370.01, "So we now have the ability to log in."], [6373.4, "So if we go ahead and run this program, python manage.py run server,"], [6377.36, "we should see users.views has no attribute log in view."], [6381.8, "All right, it looks like I called this function log in request."], [6385.25, "It should actually be called log in view."], [6387.14, "And I\u0027ll also need a function called log out view."], [6390.08, "But I haven\u0027t implemented that yet."], [6391.94, "So I\u0027ll just go ahead and say pass for now,"], [6393.85, "but I\u0027ll come back to that later to implement the log out view."], [6397.28, "All right, so it looks like my web server is running now."], [6399.8, "And before I actually go to the login page,"], [6401.96, "let me first go back to the admin page and actually just create some users."], [6405.8, "I can go to users and then add, and let\u0027s add a user."], [6409.14, "The user name will be Harry, for example."], [6411.77, "And we\u0027ll go ahead and give Harry a password."], [6414.467, "And we\u0027ll go ahead and save and add another."], [6416.3, "Let\u0027s add maybe Ron as well."], [6419.86, "Go ahead and add him."], [6421.31, "We\u0027ll go ahead and save that."], [6422.572, "And these users, they can have additional information"], [6424.78, "associated with them."], [6425.655, "I can give Ron a name like Ron Weasley, RonWeasley@example.com"], [6429.405, "is his email address."], [6430.75, "There are a bunch of default fields that Django gives you"], [6433.42, "for manipulating users."], [6434.732, "And you can take these users and go ahead and add to those fields"], [6437.44, "if I want to."], [6438.01, "Giving them a first name, last name, email address, and whatnot."], [6441.69, "And you can also customize these fields as well."], [6443.69, "If you\u0027d like to add custom fields that you would like to keep track of with"], [6446.98, "regards to your individual users."], [6449.59, "And I will go ahead and log out from Django admin"], [6451.72, "now because I don\u0027t need it anymore."], [6453.88, "But now, if I go to /users, I\u0027m not authenticated."], [6458.315, "So what I see is a log in form that just looks like this."], [6460.69, "A place for me to type in a user name and a password."], [6464.02, "And of course, I could type in Harry\u0027s username and password."], [6466.57, "But I haven\u0027t yet implemented the processing of that data yet."], [6469.84, "So let\u0027s go ahead and do that now."], [6472.28, "We\u0027ll go ahead and go back to views.py."], [6475.27, "In the log in view, there are two ways the log in view function"], [6477.933, "could be called."], [6478.6, "One is via the get request method, meaning just show me the log in form."], [6482.26, "And one is via post, submit data to the log in form as well."], [6485.84, "So if the request method is post, well then,"], [6490.57, "let me first get the user name which will be inside of the post"], [6493.63, "data in a field called user name."], [6495.73, "And let me get the password, which will be"], [6497.71, "in a field in the request.post inside of password."], [6502.71, "And now what I\u0027d like to do is try to authenticate this user."], [6506.65, "And how do I go about doing that?"], [6508.17, "Well, it turns out there are a couple of functions that Django"], [6510.17, "has given to me that I can import."], [6511.93, "So from django.contrib.auth, auth for authentication."], [6516.2, "I\u0027m going to import three functions we\u0027re ultimately going to use."], [6518.99, "One is authenticate that checks if user name and password are correct."], [6522.66, "One is called log in, one is called log out."], [6527.41, "And I can now use those functions inside of this log in view here."], [6530.93, "After I\u0027ve gotten the username and password,"], [6532.88, "I\u0027d like to authenticate the user."], [6534.41, "Check if the user name and password are correct."], [6537.06, "So I\u0027ll go ahead and say user is equal to authenticate request username is"], [6542.24, "the username password equals password."], [6545.28, "And so authenticate is a function."], [6546.83, "Just takes the request, takes a user name, takes a password,"], [6550.4, "and if the user name and password are valid,"], [6552.53, "they give me back who the user actually is."], [6556.14, "And as long as the user is not none, that"], [6560.45, "means the authentication was successful, and I can go ahead and log the user in."], [6564.56, "How do I log the user in?"], [6566.06, "I use the log in function the Django gives me."], [6568.49, "Logging in with this request, this user."], [6571.92, "And now I can go ahead and redirect them."], [6574.34, "HttpResponseRedirect the user back to the index route."], [6578.54, "Back to the original route that the user started out as."], [6581.307, "And so that\u0027s if the user is not none."], [6582.89, "If the authentication was successful."], [6584.93, "But otherwise, if the authentication failed, what should I do?"], [6588.62, "Well, let me go ahead and render the same users login page again."], [6593.75, "But let me add some additional context."], [6596.27, "The context will be a message that says invalid credentials."], [6602.4, "And now, inside of login.html, I can just"], [6605.06, "add some logic that says, if there\u0027s a message,"], [6608.45, "then go ahead and display that message inside of a div."], [6612.62, "And then endif to end that."], [6614.09, "So if there is a message, we\u0027ll see the message printed."], [6616.55, "Otherwise, we won\u0027t see it at all."], [6619.41, "So now, if I go ahead and refresh the login page,"], [6622.07, "nothing seems to have changed."], [6623.54, "But let\u0027s say I type in a user name that doesn\u0027t exist."], [6625.9, "Hermione and some password and I log in."], [6628.88, "Well, then I get this error message."], [6630.38, "Invalid credentials."], [6631.49, "We were not able to log the user in."], [6633.84, "So what happens if we do successfully logged in?"], [6636.29, "Well, then the user is going to be taken to this index route."], [6640.468, "And it looks like now we need to finish off this index route."], [6643.01, "What does the index route do?"], [6644.54, "Well, let\u0027s go ahead and return render a template called users/user.html."], [6652.28, "And inside of user.html, we\u0027ll go ahead and display"], [6656.98, "some information about the user."], [6659.53, "We\u0027ll still extend user/layout because we\u0027re"], [6662.23, "going to use the same basic layout."], [6664.36, "But in the body of this page, the information I want to show--"], [6668.22, "if I want to say welcome and then like Harry or welcome Ron or whoever"], [6673.06, "the user happens to be."], [6675.05, "And it turns out inside of Django templates,"], [6677.44, "I have access to the request that was used to make this HTTP request, which"], [6681.88, "means I also have access to request.user who is the user associated"], [6686.29, "with that request."], [6687.58, "And if the user has a first name, I can access request.user.firstname."], [6693.545, "And in addition to that, I can display other information."], [6695.92, "Maybe their user name is request.user.username."], [6699.7, "And maybe their email address is request.user.email."], [6703.93, "And so I can show the user information about them."], [6707.65, "Such that if Harry logs in, for example, I sign in as Harry,"], [6711.49, "sign in with Harry\u0027s credentials, click log in."], [6716.05, "Well then, Harry sees a page that says welcome Harry."], [6718.96, "Harry is logged in."], [6720.04, "They are request.user."], [6722.02, "And using that information, we can access first name, username, and email"], [6727.15, "as well just by accessing properties of request.user."], [6731.95, "Now, last thing we need to add, which still doesn\u0027t yet exist,"], [6735.01, "is a way to actually log the user out."], [6737.51, "And it turns out that just as Django has a log in function,"], [6741.37, "Django also has a log out function that handles log out for us so we"], [6744.61, "don\u0027t need to implement it ourselves."], [6746.44, "So all our log out view needs to do is make a call to this log out function."], [6751.69, "And then, figure out where should the user go after they\u0027ve been logged out."], [6754.9, "And you know what, let\u0027s go ahead and take them back to the login page"], [6760.4, "with a message of logged out to indicate that the user has now been logged out."], [6766.4, "Then in user.html, we\u0027ll go ahead and add a link that will go to the log"], [6774.29, "out route that just says, log out, for example."], [6779.9, "So now, when Harry goes back to Harry\u0027s page,"], [6781.96, "Harry sees a URL that says log out."], [6784.15, "If Harry clicks log out, Harry gets logged out is brought back to this page"], [6788.38, "because now request.user.isauthenticated is going to be false."], [6792.53, "There is no authenticated user."], [6794.41, "And so they now see just the default login page."], [6797.47, "And if now Ron were to log in, for example, using Ron\u0027s username"], [6801.31, "and Ron\u0027s password logging in, then Ron now"], [6804.7, "sees information associated with him as well."], [6807.97, "So Django gives us a lot out of the box."], [6810.01, "Gives us the ability to represent these models in admin interface,"], [6813.19, "to be able to manipulate them."], [6814.54, "A migration system that allows us to very quickly make changes to our models"], [6818.47, "and apply them to our database."], [6820.06, "And also, a built in user authentication system."], [6822.52, "A system that allows us to very quickly enable"], [6825.13, "users to be able to log in, log out, from our web application as well."], [6829.398, "So all of this are features that just helps"], [6831.19, "to make it so that we can very quickly take advantage of things like SQL"], [6834.76, "and models and migrations to build dynamic, interesting web"], [6837.94, "applications with data to back them up."], [6840.61, "This was web programming with Python and JavaScript."], [6842.89, "We will see you next time."]];
            
            // Add captions to dropdown
            for (let caption of captions) {

                // Floor start (to match YouTube timeline)
                const start = Math.floor(caption[0]);

                // Add caption to dropdown
                const url = new URL(window.location.href);
                url.searchParams.set('start', start)
                url.searchParams.delete('end');
                const $a = $('<a class="dropdown-item overflow-hidden text-truncate" data-start="' + start + '" href="' + url.href + '">');
                let $span = $('<span class="d-inline-block me-3 text-end">');
                $span.append($('<span class="badge text-bg-secondary">').text(numeral(start).format('00:00:00')));
                $a.append($span);
                $span = $('<span data-text>').text(caption[1]);
                $a.append($span);
                $('#captions').append($('<li>').append($a));

                // Listen for clicks
                $a.on('click', function(event) {
                    if ($('#switch').is(':checked')) {
                        YT.get('screen').seekTo(start - offset);
                        YT.get('screen').playVideo();
                    }
                    else {
                        YT.get('main').seekTo(start);
                        YT.get('main').playVideo();
                    }
                    event.preventDefault();
                    bootstrap.Dropdown.getOrCreateInstance($('#captions-button').get(0)).hide();
                });
            }

            // Scroll to closest caption by default
            const shown = function() {
                $('#captions [data-start]').removeAttr('data-top');
                $('#captions').scrollTop(0);
                const t = Math.round(($('#switch').is(':checked')) ? YT.get('screen').getCurrentTime() : YT.get('main').getCurrentTime());
                const captions = $('#captions [data-start]').get();
                for (let i = 0; i < captions.length; i++) {
                    let $caption = $(captions[i]);
                    if ($caption.attr('data-start') >= t) {
                        if (i >= 2) {
                            $caption = $(captions[i - 2]);
                        }
                        else if (i === 1) {
                            $caption = $(captions[i - 1]);
                        }
                        $('#captions').scrollTop($caption.position().top); // https://stackoverflow.com/a/23116056
                        $caption.attr('data-top', '');
                        break;
                    }
                }
                $('#q').focus();
            };
            $('#captions').parent().on('shown.bs.dropdown', shown);

            // Hide captions if they were opened via focus and then navbar is clicked
            // https://stackoverflow.com/questions/152975/how-do-i-detect-a-click-outside-an-element/3028037#3028037
            $(document).click(function(event) { 
                if (!$(event.target).closest($('#captions').closest('.input-group')).length) {
                    bootstrap.Dropdown.getOrCreateInstance($('#captions-button').get(0)).hide();
                }
            });

            
            // Hide chapters when showing captions
            $('#captions').parent().on('show.bs.dropdown', function() {
                bootstrap.Dropdown.getOrCreateInstance($('#chapters-button').get(0)).hide();
            });
            

            // Show captions on focus
            $('#q').on('click focus', function() {
                bootstrap.Dropdown.getOrCreateInstance($('#captions-button').get(0)).show();
            });

            // Listen for searches
            $('#q').closest('form').on('submit', function(e) {
                e.preventDefault();
            });
            const $spans = $('#captions .dropdown-item span[data-text]');
            $('#q').on('keyup search', function(e) {
                const value = $(this).val().trim().toLowerCase();
                if (value.length >= 2) {
                    const regexp = new RegExp(value, 'i');
                    $spans.each(function(index, element) {
                        const $span = $(element);
                        if ($span.text().toLowerCase().includes(value)) {
                            $span.html($span.text().replace(regexp, function(match) {
                                return '<mark>' + match + '</mark>';
                            }));
                            $span.parent().removeClass('d-none');
                        }
                        else {
                            $span.parent().addClass('d-none');
                        }
                    });
                    if ($('#captions .dropdown-item:not(.d-none)').length === 0) {
                        $('#captions').addClass('d-none');
                    }
                    else {
                        $('#captions').removeClass('d-none');
                    }
                }
                else {
                    $spans.each(function(index, element) {
                        const $span = $(element);
                        $span.html($span.text());
                        $(element).parent().removeClass('d-none');
                    });
                    $('#captions').removeClass('d-none');
                }
                stretch({target: $('#captions').get(0)});
            });

            // Enable captions
            $('#captions').prev('[data-bs-toggle="dropdown"]').removeAttr('disabled');
            $('#q').removeAttr('disabled');

            

            // Listen for clicks on iframe
            window.addEventListener('blur', function() {

                
                // Hide chapters
                bootstrap.Dropdown.getOrCreateInstance($('#chapters-button').get(0)).hide();
                

                // Hide snacks
                bootstrap.Dropdown.getOrCreateInstance($('#snacks-button').get(0)).hide();

                
                // Hide captions
                bootstrap.Dropdown.getOrCreateInstance($('#captions-button').get(0)).hide();
                
            });

            // Stretch badges' parents so all same size
            const stretch = function(e) {
                const $parents = $(e.target).find('.bg-dark').parent();
                const width = Math.max.apply(null, $parents.map(function(index, domElement) { return $(domElement).outerWidth(); }));
                $parents.css('width', width + 'px');
            };
            
            $('#captions').parent().on('shown.bs.dropdown', stretch);
            
            
            $('#chapters').parent().on('shown.bs.dropdown', stretch);
            

            // Load YouTube Player API
            // https://developers.google.com/youtube/iframe_api_reference#Getting_Started
            const tag = document.createElement('script');
            tag.src = 'https://www.youtube.com/iframe_api';
            const firstScriptTag = document.getElementsByTagName('script')[0];
            firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);

            

            // Players for main and screen
            let main, screen;

            // https://developers.google.com/youtube/iframe_api_reference#Requirements
            function onYouTubeIframeAPIReady() {

                // Instantiate player for main
                new YT.Player('main', {
                    events: {
                        onPlaybackRateChange: function(event) {

                            // Synchronize playback rates
                            if (screen) {
                                screen.setPlaybackRate(main.getPlaybackRate());
                            }
                        },
                        onReady: function(event) {

                            // Remove API-added attributes
                            $('#main').removeAttr('height').removeAttr('title').removeAttr('width');

                            // Reveal main
                            $('#main').removeClass('invisible');

                            // If not iframed
                            if (window.self === window.top) {

                                // Try to autostart (if not blocked by browser)
                                event.target.playVideo();
                            }

                        },
                        onStateChange: function(event) {

                            // If main just instantiated
                            if (!main) {

                                // If just started player
                                if (event.target.getPlayerState() === YT.PlayerState.PLAYING) {

                                    // Remember player for main
                                    main = event.target;

                                    // Instantiate player for screen
                                    new YT.Player('screen', {
                                        events: {
                                            onPlaybackRateChange: function(event) {

                                                // Synchronize playback rates
                                                main.setPlaybackRate(screen.getPlaybackRate());
                                            },
                                            onReady: function(event) {

                                                // Remove API-added attributes
                                                $('#screen').removeAttr('height').removeAttr('title').removeAttr('width');

                                                // Mute screen
                                                event.target.mute();

                                                // Start screen
                                                event.target.playVideo();
                                            },
                                            onStateChange: function(event) {

                                                // If screen just instantiated
                                                if (!screen) {

                                                    // If just started playing
                                                    if (event.data === YT.PlayerState.PLAYING) {
                                                        event.target.pauseVideo();
                                                    }

                                                    // If just paused for first time
                                                    else if (event.data === YT.PlayerState.PAUSED) {

                                                        // Remember player for screen
                                                        screen = event.target;
                                                
                                                        // Synchronize playback rates
                                                        screen.setPlaybackRate(main.getPlaybackRate());

                                                        // Unmute screen
                                                        screen.unMute();

                                                        // Enable switch
                                                        $('#switch').removeAttr('disabled');

                                                        // Synchronize main and screen
                                                        window.setInterval(function() {

                                                            // If switch is checked
                                                            if ($('#switch').is(':checked')) {

                                                                // Sync main to screen
                                                                if ([YT.PlayerState.PLAYING, YT.PlayerState.PAUSED].includes(screen.getPlayerState())) {
                                                                    const seconds = screen.getCurrentTime() + offset;
                                                                    if (main.getCurrentTime() !== seconds) {
                                                                        main.seekTo(seconds);
                                                                    }
                                                                }

                                                                // Ensure main is paused, especially on mobile
                                                                main.pauseVideo();
                                                            }

                                                            // If switch is unchecked
                                                            else {

                                                                // Sync screen to main
                                                                if ([YT.PlayerState.PLAYING, YT.PlayerState.PAUSED].includes(main.getPlayerState())) {
                                                                    const seconds = main.getCurrentTime() - offset;
                                                                    if (screen.getCurrentTime() !== seconds) {
                                                                        screen.seekTo(seconds);
                                                                    }
                                                                }

                                                                // Ensure screen is paused, especially on mobile
                                                                screen.pauseVideo();
                                                            }
                                                        }, 500);
                                                    }
                                                }

                                                // If players are synchronizing
                                                else {

                                                    // Ensure switch is enabled again
                                                    if (event.data === YT.PlayerState.PLAYING) {
                                                        $('#switch').removeAttr('disabled');
                                                    }
                                                }
                                            }
                                        },
                                        playerVars: $.extend({"autoplay": "0", "enablejsapi": "1", "iv_load_policy": "3", "mute": "0", "origin": "https://video.cs50.io", "playsinline": "1", "rel": "0", "showinfo": "0", "start": 3812.0}, playerVars),
                                        videoId: "VuB5TkTL3tM"
                                    });
                                }
                            }
                            else {

                                // Ensure switch is enabled again
                                if (event.data === YT.PlayerState.PLAYING) {
                                    $('#switch').removeAttr('disabled');
                                }
                            }
                        }
                    },
                    playerVars: $.extend({"autoplay": "0", "enablejsapi": "1", "iv_load_policy": "3", "mute": "0", "origin": "https://video.cs50.io", "playsinline": "1", "rel": "0", "showinfo": "0", "start": 3812.0}, playerVars),
                    videoId: "YzP164YANAU"
                });
            }

            // Listen for switch
            $('#switch').on('change', function() {

                // If switch checked
                if ($('#switch').is(':checked')) {

                    // If main was playing
                    if (main.getPlayerState() === YT.PlayerState.PLAYING) {

                        // Disable switch until screen is playing
                        $('#switch').attr('disabled', true);

                        // Pause main
                        main.pauseVideo();

                        // Play screen
                        screen.playVideo();
                    }

                    // Swap players
                    $('#main').addClass('d-none');
                    $('#screen').removeClass('d-none');
                }

                // If switch unchecked
                else {

                    // If screen was playing
                    if (screen.getPlayerState() === YT.PlayerState.PLAYING) {

                        // Disable switch until main is playing
                        $('#switch').attr('disabled', true);

                        // Pause screen
                        screen.pauseVideo();

                        // Play main
                        main.playVideo();
                    }

                    // Swap players
                    $('#screen').addClass('d-none');
                    $('#main').removeClass('d-none');
                }
            });

            

            // Serve snacks
            // https://unicode.org/emoji/charts/full-emoji-list.html
            const snacks = {
                'food-sweet': ['', '', '', '', '', '', '', '', '', ''],
                'food-fruit': ['', '', '', '', '', '', '', '', '', '', '', '', '', '']
            };
            const $divider = $('<li><hr class="dropdown-divider"></hr></li>');
            const $item = $('<li><a class="dropdown-item"></li>');
            $('#snacks').append($item.clone().children().text(['', ''][Math.floor(Math.random(2))]));
            for (key in snacks) {
                $('#snacks').append($divider.clone());
                $('#snacks').append($item.clone().children().text(snacks[key].splice(Math.floor(Math.random() * snacks[key].length), 1)));
            }
            $('#snacks').append($divider.clone());
            $('#snacks').append($item.clone().children().text(''));

            // Ensure snacks are cross-platform
            twemoji.parse($('#snacks').get(0), {base: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/'});

            // Listen for snacks
            $('#snacks .dropdown-item').click(function(event) {
                $(this).html(twemoji.parse('', {base: 'https://cdn.jsdelivr.net/gh/twitter/twemoji@14.0.2/assets/'})).addClass('disabled').attr('aria-disabled', 'true');
                return false;
            });

            // Before shortcuts are shown
            $('#shortcuts').on('show.bs.modal', function(event) {
                if ($('#shortcuts').data('danger')) {
                    $('#shortcuts .alert').removeClass('alert-warning').addClass('alert-danger');
                    $('#shortcuts').removeData('danger');
                }
                else {
                    $('#shortcuts .alert').removeClass('alert-danger').addClass('alert-warning');
                }
            });

            // Listen for keydown
            $(document).keydown(function(e) {

                // If keydown was in search box and was down arrow
                if ($(e.target).attr('id') === 'q' && e.which === 40) {
                    $('#captions [data-top]').focus();
                    e.preventDefault();
                }
            });

            // Listen for keyup
            $(document).keyup(function(e) {

                // If Escape
                if (e.key === 'Escape') {

                    // Close modal (if open)
                    bootstrap.Modal.getOrCreateInstance($('#shortcuts').get(0)).hide();

                    // Close captions (if open)
                    bootstrap.Dropdown.getOrCreateInstance($('#captions-button').get(0)).hide();
                    $('#q').blur();
                }

                // If keyup was in search box
                if ($(e.target).attr('id') === 'q') {

                    // In case user hid captions with Escape, re-show since user is now typing
                    if (e.key !== 'Escape') {
                        bootstrap.Dropdown.getOrCreateInstance($('#captions-button').get(0)).show();
                    }

                    // Ignore event otherwise so that it propagates to search box
                    return;
                }

                // If question mark
                if (e.key === '?') {
                    bootstrap.Modal.getOrCreateInstance($('#shortcuts').get(0)).show();
                }

                // Listen for keyups intended for iframe
                const keys = [
                    ' ',
                    ',',
                    '.',
                    '<',
                    '>',
                    'c',
                    'f',
                    'j',
                    'k',
                    'l',
                    'm'
                ];
                if (keys.includes(e.key)) {
                    $('#shortcuts').data('danger', true);
                    bootstrap.Modal.getOrCreateInstance($('#shortcuts').get(0)).show();
                }
            });

            // Every 500ms
            let end;
            window.setInterval(function() {

                // If a player is foregrounded (and ready)
                let player;
                if (screen && $('#switch').is(':checked')) {
                    player = screen;
                }
                else if (main) {
                    player = main;
                }
                if (player) {

                    // Current timecode
                    const t = Math.round(player.getCurrentTime());

                    // Current URL
                    const url = new URL(window.location.href);
            
                    // Get start from URL
                    let start;
                    try {
                        start = parseInt(url.searchParams.get('start'));
                    }
                    catch (err) {}

                    // Remove end from URL from URL
                    if (url.searchParams.get('end')) {
                        if (player.getPlayerState() === YT.PlayerState.PLAYING) {
                            try {
                                end = parseInt(url.searchParams.get('end'));
                                url.searchParams.delete('end');
                                history.replaceState(null, '', url);
                            }
                            catch (err) {}
                        }
                    }

                    // If end is set
                    if (typeof end !== 'undefined') {

                        // And player has reached it, pause video
                        if (player.getPlayerState() === YT.PlayerState.PLAYING && t === end) {
                            player.pauseVideo();
                        }

                        // If player has reached or passed it, forget end
                        if (t >= end) {
                            end = undefined;
                        }
                    }

                    // If paused, add timecode (if not 0) to URL
                    if (player.getPlayerState() === YT.PlayerState.PAUSED && t !== 0) {
                        if (start !== t) {
                            url.searchParams.set('start', t);
                            history.replaceState(null, '', url);
                        }
                    }

                    // If playing, remove timecode from URL
                    else if (player.getPlayerState() === YT.PlayerState.PLAYING) {
                        if (start) {
                            url.searchParams.delete('start');
                            history.replaceState(null, '', url);
                        }
                    }

                    // Update external link in navbar
                    const $a = $('nav .fa-external-link-alt').parent();
                    if ($a.attr('href') !== url && t != 0) {
                        url.searchParams.set('start', t);
                        $a.attr('href', url);
                    }

                    // Remember timecode in localStorage if more than a minute from start or end
                    try {
                        if (t > 60 && Math.round(player.getDuration()) - t > 60) {
                            localStorage.setItem(url.pathname.slice(1), t);
                        }
                        else {
                            localStorage.removeItem(url.pathname.slice(1));
                        }
                    }
                    catch(err) {}
                }
            }, 500);
 
            // Resize UI
            $(window).resize(resize).trigger('resize');

            // Reveal UI
            $('body').removeClass('invisible');

        </script>

    </body>

</html>